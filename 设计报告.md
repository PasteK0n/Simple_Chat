
## 一. 体系结构设计


### 1.需求分析

#### 1.1 功能需求
- 用户系统：注册、登录、注销、资料管理
- 好友系统：添加好友、删除好友、好友列表
- 消息系统：文本消息发送与接收、聊天记录本地保存
- 通信机制：基于 WebSocket 的实时聊天
- 前端展示：简单图形界面（Web）或命令行客户端

#### 1.2 非功能需求
- 安全性：用户密码加密存储，简单身份验证
- 可维护性：代码结构清晰，逻辑分层，便于测试与扩展
- 部署性：支持在本地或校园局域网中部署
- 学习性：便于展示分层架构与模块复用思想

### 2.概念设计

系统采用五层架构设计，初步划分为：表示层、应用层、业务逻辑层、数据访问层和数据层。各层职责如下：

```
[Client UI] --> [Flask Controller] --> [Service Logic] --> [Repository / DAO] --> [SQLite / Redis]
```

### 3.体系结构精化

#### 3.1 表示层
- 功能：用户交互界面（Web前端或CLI）
- 技术：HTML + JavaScript（或Python CLI）

#### 3.2 应用层
- 功能：请求分发、参数校验、结果封装
- 技术：Flask 路由函数

#### 3.3 业务逻辑层
- 功能：用户验证、消息处理、好友管理等核心逻辑
- 技术：Python Service 类（面向对象设计）

#### 3.4 数据访问层
- 功能：与数据库交互，封装 SQL 操作
- 技术：SQLAlchemy ORM 或原生 SQLite 操作封装

#### 3.5 数据层
- 功能：本地数据持久化存储
- 技术：SQLite（主数据库）、Redis（缓存，可选）

#### 构件图
```
[Client] --HTTP/WebSocket--> [Flask App] --> [Service Layer] --> [DAO] --> [SQLite DB]
```

#### 部署图
```
+-------------------+
|     Client App    |
+--------+----------+
         |
         v
+--------+----------+
| Flask Server (WS) |
+--------+----------+
         |
         v
+-------------------+
| SQLite / Redis DB |
+-------------------+
```

### 4.构建设计与复用

- 语言与框架：Python 3.10，Flask，Flask-SocketIO
- 数据库与ORM：SQLite（轻量数据库），SQLAlchemy
- 模块划分：用户模块、消息模块、好友模块、数据库模块
- 工具链与依赖：venv、pip、Git、Postman（接口测试）
- 复用思路：
  - 通用 JSON 响应封装模块
  - 配置文件与数据库封装复用
  - Service-DAO 模式封装

### 5.体系结构验证

- 代码走查：检查分层结构是否清晰、接口是否规范
- 模块测试：每层编写基本单元测试，保证接口正常
- 验证重点：学生是否理解各层职责，能否灵活调整结构
- 测试工具：unittest、Flask 自带测试工具

## 二. 功能设计

本部分详细阐述即时通讯（IM）软件的核心功能模块及其子功能，旨在提供一个全面、专业的功能设计蓝图。

### 1. 核心功能模块概述

即时通讯软件的核心功能可以划分为以下主要模块：

* **I. 用户账户管理 (User Account Management):** 负责用户身份的创建、验证、配置和安全管理。
* **II. 消息通讯 (Message Communication):** 实现用户之间多种形式信息的实时或异步交换。
* **III. 联系人与关系链管理 (Contact & Relationship Management):** 管理用户的社交网络，包括好友添加、分组、权限设置等。
* **IV. 实时音视频通话 (Real-time Audio/Video Communication):** 提供一对一及多人语音和视频通话功能。
* **V. 通知与提醒 (Notification & Reminder System):** 确保用户及时接收到新消息、请求和系统公告等重要信息。
* **VI. 设置与其他辅助功能 (Settings & Other Auxiliary Functions):** 提供个性化配置选项，并包含提升用户体验的各类辅助工具。
* **VII. 安全与隐私保护 (Security & Privacy Protection):** 保障用户数据安全、通信保密及个人隐私不受侵犯。

以下各节将对这些核心模块的详细功能进行阐述。

### 2. 用户账户管理 (User Account Management)

用户账户管理模块是用户与 IM 系统交互的基础，提供全面的账户生命周期管理和个性化配置。

**(a) 用户注册与登录**

* **用户注册:**
    * **手机号注册:**
        * 输入手机号码。
        * 通过短信验证码进行验证（验证码有效性、防刷机制、发送频率限制）。
        * 设置初始密码（密码强度要求：长度、大小写字母、数字、特殊字符组合，并进行实时校验提示）。
        * 必须勾选同意用户协议和隐私政策。
    * **邮箱注册:**
        * 输入邮箱地址。
        * 通过邮件发送验证链接或验证码进行验证（验证链接/码有效性、防刷机制）。
        * 设置初始密码（同手机号注册的密码强度要求）。
        * 必须勾选同意用户协议和隐私政策。
    * **用户名/昵称注册 (可选，通常作为辅助或特定场景):**
        * 输入唯一的用户名/昵称（实时唯一性校验）。
        * 设置密码。
        * 强烈建议引导用户绑定手机号或邮箱作为安全验证和找回密码途径。
        * 必须勾选同意用户协议和隐私政策。
    * **注册信息校验:** 对所有用户输入（如手机号格式、邮箱格式、密码复杂度、用户名合法性等）进行前端实时校验和后端最终校验。
    * **用户协议与隐私政策:** 注册流程中必须清晰展示用户协议和隐私政策，并要求用户明确同意后方可完成注册。提供易于访问的链接。

* **用户登录:**
    * **账号密码登录:**
        * 输入已注册的手机号/邮箱/用户名。
        * 输入密码（密码输入框提供显示/隐藏密码切换功能）。
        * 可选：“记住密码”功能（通过在客户端安全存储授权 token 实现，非明文密码）。
        * 可选：“自动登录”功能（下次启动应用时自动使用已保存的 token 登录）。
        * 登录错误提示（如“用户名或密码错误”、“账户不存在”、“账户已冻结”等清晰具体的提示）。
        * 密码输入错误次数限制与临时锁定机制（例如，连续5次错误后，账户锁定15分钟或需要额外验证）。
    * **验证码登录 (通常用于手机号):**
        * 输入手机号。
        * 获取并输入短信验证码进行登录（适用于快速登录或忘记密码场景，验证码具有时效性和单次有效性）。
    * **第三方账号登录 (OAuth/OpenID Connect):**
        * 支持集成主流第三方平台（如微信、QQ、微博、Google、Facebook、Apple ID 等）进行授权登录。
        * 首次第三方登录需引导用户绑定到现有账户或快速创建新账户（可能需要补充少量必要信息）。
        * 在账户设置中管理已绑定的第三方账号，支持解绑操作（解绑前进行安全确认）。
    * **扫码登录 (QR Code Login):**
        * 移动端App扫描桌面端/Web端生成的动态二维码。
        * 二维码包含唯一标识，并有固定刷新周期（如30秒-1分钟）以保证安全。
        * 移动端App显示待登录的设备信息（如“即将登录XX Windows客户端”），用户确认后，桌面端/Web端完成登录。
        * 二维码状态实时更新（待扫描、已扫描待确认、已登录、已过期）。
    * **生物识别登录 (Biometric Login):**
        * 在支持指纹、面容ID等生物识别的设备上，允许用户在启用“记住密码”或“自动登录”后，使用生物特征进行快速解锁或登录应用。
    * **忘记密码/密码找回:**
        * 提供多种密码找回途径：
            * 通过已绑定的手机号接收短信验证码重置密码。
            * 通过已绑定的邮箱接收验证链接或验证码重置密码。
            * 通过回答预设的密保问题进行身份验证后重置密码（需确保密保问题答案的安全性）。
        * 重置密码时，新密码需符合强度要求，且不能与最近使用过的若干个旧密码相同。

**(b) 个人资料管理**

用户可以设置和修改其公开或半公开的个人信息，以展示个性化身份，并管理这些信息的可见性。

* **头像设置与修改:**
    * 支持从设备本地相册选择图片或调用相机即时拍照上传。
    * 提供图片裁剪（支持不同比例，如1:1）、旋转等基本编辑功能。
    * 头像格式支持（JPEG, PNG, GIF等），明确文件大小限制（如5MB）。
    * 历史头像记录与选择功能（可选，允许用户快速切换回以前用过的头像）。
    * 系统提供一组默认头像供用户选择，或根据用户昵称首字生成一个简约头像。
* **昵称设置与修改:**
    * 允许用户设置个性化昵称。
    * 昵称长度限制（如2-30个字符）、允许的字符类型（禁止使用非法字符或敏感词，需后端校验）。
    * 昵称修改频率限制（可选，如每月1次，防止恶意频繁修改）。
    * 昵称是否允许重复（若允许重复，则用户唯一标识仍为用户ID；若不允许，则需进行唯一性校验）。
* **个性签名设置与修改:**
    * 用户可以输入一段文字作为个性签名，展示心情、状态或座右铭。
    * 签名长度限制（如50-100字符），允许的字符类型。
* **性别设置:**
    * 提供男、女选项，以及“保密”或“不设置”选项。
* **地区设置:**
    * 允许用户从预设的地理位置库中选择国家、省份/州、城市信息。
    * 可选择通过设备定位服务自动获取当前位置（需用户明确授权）。
* **生日设置:**
    * 用户可设置公历或农历生日信息。
    * 可选择是否对他人可见，或仅对好友可见，或显示星座/年龄段而非具体日期。
* **职业、行业、学校、兴趣爱好等扩展信息:**
    * 提供预设标签库供用户选择，或允许用户自定义输入。
    * 这些信息有助于用户发现同好或用于个性化推荐（需用户同意）。
    * 用户可精细控制各项扩展信息的对外可见性。
* **个人二维码名片:**
    * 系统为每个用户生成唯一的、包含用户ID或其他可识别信息的二维码名片。
    * 二维码样式可进行一定程度的个性化（如嵌入小头像）。
    * 支持保存二维码图片到本地相册，或直接分享给其他应用/好友。
* **资料隐私设置:**
    * 提供统一的入口，允许用户详细设置各项个人资料（头像、昵称、性别、地区、生日、朋友圈/动态等）对好友、陌生人或特定人群的可见权限。

**(c) 账户安全设置**

提供多层次的安全措施，保障用户账户不被非法访问、盗用或滥用。

* **密码修改:**
    * 用户在已登录状态下可以修改当前账户密码。
    * 修改前必须验证当前密码（旧密码）。
    * 新密码必须符合预设的密码强度策略，并与近期使用过的密码不同。
    * 密码修改成功后，应通知用户，并可选择是否下线其他已登录设备。
* **密保问题设置与修改:**
    * 用户可以设置一个或多个安全保护问题及其对应的答案。
    * 用于辅助密码找回或进行敏感操作时的身份二次验证。
    * 引导用户设置不易被猜到但自己容易记住的问题和答案。
    * 密保答案在存储和传输过程中必须加密。
    * 修改密保问题需验证身份（如通过密码或短信验证码）。
* **两步验证 (2FA - Two-Factor Authentication) / 多因素认证 (MFA):**
    * 强烈建议用户启用。启用后，在输入密码（第一因素）之外，还需提供第二重验证凭据。
    * 支持基于时间的一次性密码 (TOTP)，通过身份验证器应用（如 Google Authenticator, Microsoft Authenticator, Authy 等）生成。
    * 支持通过已绑定的安全手机接收短信验证码或安全邮箱接收邮件验证码作为第二因素。
    * 提供一组一次性的备用恢复码，供用户在无法使用常规第二因素设备时登录账户。
    * 用户可管理已信任的设备，在信任设备上可选择在一定时期内免除2FA。
* **绑定与修改安全手机/邮箱:**
    * 引导用户绑定经过验证的手机号码和邮箱地址，作为接收安全通知、验证码、密码重置链接等重要信息的渠道。
    * 支持修改或解绑已绑定的手机/邮箱，操作前必须进行严格的身份验证（如通过密码+另一绑定方式验证，或通过2FA验证）。
* **设备管理:**
    * 清晰列出用户当前及近期曾登录过的设备列表，包含设备型号、操作系统版本、应用版本、最近登录时间、登录IP及大致地理位置。
    * 允许用户查看当前在线的设备。
    * 允许用户远程强制下线（登出）指定的单个设备或所有其他设备。
    * 新设备首次登录时，向已绑定的安全手机/邮箱或已登录的信任设备发送提醒通知。
* **登录历史记录查询:**
    * 提供查询最近一段时间（如30天）的登录尝试记录，包括登录时间、IP地址、地理位置（大致估算）、登录所用设备类型和操作系统、登录结果（成功/失败）以及失败原因（如密码错误、验证码错误）。
    * 帮助用户及时发现和识别异常登录活动。
* **账户冻结/锁定与申诉:**
    * 用户在怀疑账户被盗或存在安全风险时，可主动申请临时冻结账户以阻止进一步操作。
    * 系统在检测到严重异常行为（如异地高危操作、密码被暴力破解尝试）时，可自动临时锁定账户。
    * 提供清晰的账户解冻/解锁流程和申诉渠道，可能需要用户提供身份证明材料。
* **安全通知与提醒:**
    * 当发生账户相关的敏感操作（如修改密码、修改绑定手机/邮箱、启用/关闭2FA、新设备登录、异地登录、密码错误次数过多等）时，通过应用内消息、短信、邮件等方式及时通知用户。

**(d) 账户状态管理**

向其他用户展示用户的当前可用性、在线情况或自定义心情，便于发起合适的交互并增强社交氛围。

* **在线状态自动与手动切换:**
    * **在线 (Online):** 用户当前活跃使用应用。系统自动检测。
    * **离线 (Offline):** 用户未登录或网络连接断开。系统自动管理。
    * **忙碌 (Busy / Do Not Disturb - DND):** 用户手动设置，表示不希望被打扰。收到消息时可能无声音/震动提醒，或通知方式减弱。
    * **隐身 (Invisible / Appear Offline):** 用户手动设置，实际在线，但对其他用户（或指定用户）显示为离线状态。用户仍可正常收发消息和使用各项功能。
    * **离开 (Away):** 用户在一段时间内（可配置，如5分钟）无任何操作，系统可自动将其状态从“在线”切换为“离开”。用户也可手动设置。
    * **自定义状态:** 允许用户设置一段简短的自定义状态文字（如“会议中”、“开车中”、“度假中”）并可选配一个相关的Emoji或预设图标。自定义状态可设置有效期。
* **状态显示与同步:**
    * 在联系人列表、聊天窗口顶部、用户资料页等界面清晰显示好友的当前在线状态和自定义状态。
    * 状态变更应尽可能实时地同步给其他相关用户。
* **自动状态变更逻辑:**
    * 例如，长时间无操作后自动从“在线”变为“离开”。
    * 网络断开或应用被操作系统杀死后自动变为“离线”。
    * 开始音视频通话时，可自动切换为“忙碌”或“通话中”状态。
* **状态隐私设置:**
    * 用户可设置谁可以看到自己的详细在线状态（例如，对所有人可见、仅好友可见、对特定好友或分组隐藏）。
    * 隐身状态的生效范围（对所有人隐身或对特定人隐身）。

#### 用户账户生命周期功能

| 功能ID | 阶段         | 具体功能           | 关键安全考量                      |
|--------|--------------|--------------------|-----------------------------------|
| UM101  | 用户引导     | 手机号注册         | 短信验证码安全传输                |
| UM102  | 用户引导     | 邮箱注册           | 邮箱验证、密码哈希                |
| UM103  | 用户引导     | 单点登录（SSO）    | OAuth/OpenID安全实施              |
| UM201  | 日常使用     | 密码登录           | 强密码策略、登录限制              |
| UM202  | 日常使用     | 生物识别登录       | 安全存储生物特征模板              |
| UM203  | 日常使用     | 多因素认证（MFA）  | 多因子选择、安全因子管理          |
| UM204  | 日常使用     | 密码重置           | 多通道验证，防止未授权重置        |
| UM205  | 日常使用     | 密码修改           | 旧密码验证，强密码策略            |
| UM301  | 用户离网     | 账户停用           | 明确数据状态，可恢复性            |
| UM302  | 用户离网     | 账户注销           | 身份确认，数据清除，合规处理      |
### 3. 消息通讯 (Message Communication)

消息通讯是 IM 软件的核心，支持多种消息类型和丰富的交互特性，满足不同场景下的沟通需求。

**(a) 一对一聊天 (Private Chat)**

* **文本消息:**
    * 支持发送和接收纯文本消息，支持长文本（有合理上限，如5000字符）。
    * 全面支持 Unicode 字符集，确保多语言环境下文字的正确显示。
    * 支持常用快捷键发送消息（如 Enter 发送，Ctrl+Enter 换行，或反之，提供设置选项）。
    * 草稿保存：未发送的输入框内容在切换聊天或关闭应用（非强制退出）后应自动保存，下次进入该聊天时恢复。
    * 支持对文本消息进行复制、粘贴、选择部分文本等操作。
    * URL自动识别与超链接化：消息中的网址能被自动识别并可点击跳转。
* **表情/Emoji/贴图 (Stickers):**
    * 内置丰富的、分类清晰的 Emoji 表情选择器，符合最新 Unicode 标准。
    * 支持动态表情（如GIF格式的小动画）和静态表情。
    * 支持自定义表情包的上传（用户从本地图片制作）、下载、管理（排序、删除）和云端同步。
    * 支持发送和接收商业化或免费的大表情/动画贴图。
    * 表情/贴图商店或推荐功能（可选），提供更多选择。
    * 表情/贴图搜索功能。
* **图片消息:**
    * 支持从设备本地相册选择单张或多张图片（有单次选择上限，如9张）发送，或调用相机即时拍照发送。
    * **图片预览:** 发送前在输入框区域提供缩略图预览，接收后在聊天流中显示缩略图，点击可进入大图查看器。
    * **图片压缩与原图选项:**
        * 发送时默认对图片进行适当压缩（保证清晰度的前提下减少文件大小），并提供“发送原图”选项。
        * 接收方可选择下载缩略图、清晰图或原图（若发送方发送了原图）。
        * 图片格式广泛支持（JPEG, PNG, GIF, WebP, HEIC 等）。
    * **图片查看器:**
        * 支持手势缩放、左右滑动切换同一批次或聊天记录中的图片。
        * 提供保存到本地设备、转发、收藏、识别图中二维码、图片编辑（裁剪、涂鸦、马赛克等简单操作）等功能。
* **语音消息:**
    * **录制:** 按住录音按钮进行录制，上滑或拖动到特定区域取消发送，松手发送。
    * **播放:** 点击播放按钮，支持暂停、继续播放、拖动进度条。
    * **时长显示:** 清晰显示每条语音消息的精确时长（秒数）。
    * 未听过的语音消息有明显标记（如小红点或“未播放”状态）。
    * 支持听筒模式（贴近耳朵时自动切换）和扬声器模式手动切换。
    * 语音消息格式（如 AMR, MP3, AAC, Opus 等），在保证音质前提下优化码率和采样率以减小文件大小。
    * 单条录音时长限制（如60秒，或更长）。
    * 语音转文字功能（可选，需集成ASR服务），转换结果显示在语音条下方，支持对转换结果进行复制和编辑。
    * 支持“连续播放”未读语音消息。
* **短视频消息:**
    * 支持从本地相册选择或调用相机即时录制短视频（时长限制，如15秒、60秒、或更长，可配置）。
    * 视频在聊天流中以内嵌播放器形式展示，点击可全屏播放。
    * 支持播放、暂停、拖动进度、音量控制、循环播放选项。
    * 视频自动压缩和格式支持（如 MP4 H.264/H.265 AAC）。
    * 视频发送前可进行简单编辑（如裁剪时长、静音、添加文字/涂鸦，可选）。
    * 支持静音播放、全屏播放、保存到本地、转发等。
* **文件消息:**
    * 支持发送各类文档（DOC, PDF, TXT等）、压缩包（ZIP, RAR等）、音视频文件及其他任意类型文件。
    * **文件类型限制:** 可配置允许或禁止发送的特定文件扩展名或MIME类型（出于安全考虑）。
    * **文件大小限制:** 单个文件大小上限（如 100MB, 1GB, 或根据用户等级/服务器配置动态调整）。
    * 文件发送和接收均有清晰的进度条显示（百分比、已传输大小/总大小、预估剩余时间）。
    * **断点续传:** 在网络中断或应用重启后，能从上次中断的位置继续上传或下载文件，避免重复传输。
    * 文件接收后，可选择直接打开（调用系统或其他应用）、保存到设备指定位置、转发等。
    * 对常见文件格式（如 PDF, DOCX, TXT, 图片, 音视频）提供应用内预览功能（可选，可能需集成第三方预览引擎或自研）。
    * 已发送/已接收文件的统一管理入口（按会话或全局）。
* **名片分享:**
    * 允许用户将自己的个人名片或已添加好友的联系人名片以结构化消息的形式发送给对方。
    * 名片消息通常包含对方头像、昵称、用户ID等关键信息，以及“添加好友”或“查看资料”的快捷操作按钮。
* **位置共享:**
    * **发送位置快照:**
        * 获取当前精确地理位置（需用户授权定位服务），或在地图上手动选择特定位置，或搜索POI（Point of Interest）发送。
        * 发送的消息包含地图截图、位置名称、详细地址文字。点击可跳转到地图应用查看详情或导航。
    * **实时位置共享:**
        * 发起方在一段时间内（如30分钟、1小时，或手动结束前）持续共享自己的实时动态位置给对方或群组。
        * 接收方可以在内置地图上看到发起方（们）的实时位置、移动轨迹、距离和方向。
        * 发起方可以随时手动停止共享。
        * 参与者头像在地图上显示，支持在共享界面进行临时语音对讲。
        * 注意电量消耗和隐私保护。
* **其他消息类型 (可扩展):**
    * **红包/转账消息:** 若集成支付功能，则支持发送和接收此类金融交易消息，有特殊UI和交互。
    * **投票消息:** 在群聊中发起单选或多选投票，成员参与投票后实时显示结果。
    * **代码片段消息:** 支持发送格式化的代码块，可选择编程语言并实现语法高亮。
    * **合并转发消息:** 将多条不同类型的消息（文本、图片、语音等）合并为一条消息进行转发，接收方可逐条查看。
    * **日程/待办消息:** 创建或分享日程事件，可设置提醒。

#### 一对一通讯功能摘要

| 功能ID | 功能名称         | 描述                                   | 关键用户交互                   | 限制/隐私控制         |
|--------|------------------|----------------------------------------|-------------------------------|-----------------------|
| C1101  | 文本消息         | 实时文本消息，支持Unicode、Emoji等      | 输入、发送、接收、查看历史     | -                     |
| C1102  | 语音消息         | 录制、发送、接收和播放短音频片段        | 录音、发送、播放、暂停         | -                     |
| C1103  | 图片共享         | 发送和接收图片，支持预览和原图查看      | 选择/拍摄、发送、查看、保存    | -                     |
| C1104  | 视频共享         | 发送和接收视频，支持预览播放            | 选择/拍摄、发送、播放、保存    | -                     |
| C1105  | 文件共享         | 发送和接收文档、压缩包等                | 选择、发送、接收、下载、打开    | -                     |
| C1106  | 已读回执         | 发送方可见消息是否被阅读                | 自动（可配置）                 | 用户可关闭            |
| C1107  | 送达状态         | 发送方可见消息是否送达                  | 自动                           | -                     |
| C1108  | 输入状态提示     | 实时显示对方是否正在输入                | 自动                           | -                     |


**(b) 群组聊天 (Group Chat)**

* **群创建与邀请:**
    * 用户可以从联系人中选择初始成员创建群组，创建者默认为群主。
    * 群主或已授权的群成员可以通过选择联系人、搜索用户ID/昵称、或分享群二维码/群邀请链接的方式邀请新成员加入。
    * 群二维码/邀请链接可设置有效期、使用次数限制，群主可使其失效。
    * 被邀请人收到邀请通知，同意后方可加入群组。
    * 群人数上限根据群类型（普通群、超级群）和服务器配置设定（如200人、500人、5000人、甚至无上限的频道）。
* **成员加入/退出/移除:**
    * 新成员加入时，群内有系统提示。
    * 群成员可以主动退出群组，群内有系统提示。
    * 群主或管理员可以将群成员移出群组（踢人），被移除成员收到通知，群内有系统提示。
* **群资料管理:**
    * **群名称设置/修改:** 群主或管理员可修改，有长度和内容限制。
    * **群头像设置/修改:** 群主或管理员可上传和修改，同个人头像。
    * **群公告设置/修改:**
        * 群主或管理员可发布和编辑富文本群公告（支持文字、图片、链接）。
        * 群公告在群聊界面置顶显示或有专门入口，新公告或重要公告会强提醒所有群成员。
        * 支持查看历史公告。
    * **群描述/简介:** 对群组的补充说明，方便新成员了解群组主题和规则。
    * **群地理位置标签 (可选):** 关联群组到一个地理位置。
* **群管理功能:**
    * **管理员设置/撤销:** 群主可以任命或撤销多名群成员为管理员，管理员拥有部分群管理权限（如邀请/移除成员、修改群资料、设置群公告、禁言成员等，权限可由群主配置）。
    * **成员禁言:**
        * 群主或管理员可以对特定群成员设置禁言（禁言一段时间，如1小时、1天、永久禁言）。被禁言成员在群内无法发送消息。
        * 全体禁言模式：群主或管理员开启后，仅群主和管理员可以发言，适用于发布重要通知或特定活动场景。
    * **入群审批:** 群主可设置新成员加入是否需要群主或管理员审批。若开启，被邀请人同意后，请求会发送给管理员审批。
    * **群消息设置 (对群整体):**
        * **消息保存时长:** 如设置群消息仅保留最近N天（可选，用于特定私密群或节省存储）。
        * **新成员查看历史消息权限:** 新成员加入后是否能查看加入前的历史消息（可配置）。
    * **群主权限转让:** 群主可以将群主身份转让给群内其他成员（需二次确认，被转让者同意）。
    * **解散群组:** 群主可以解散群组。解散后，群组不可用，所有成员被自动移出，聊天记录处理策略（本地保留、云端限期保留或立即清除）。
* **@提及成员 (@Mentions):**
    * 在群聊消息输入框中输入 "@" 符号后，自动弹出群成员列表供选择，支持模糊搜索。
    * 被提及的成员会收到强提醒通知（即使该群聊被设置为免打扰），并在其聊天列表中该群聊旁显示“有人@我”的标记。
    * 支持 "@全体成员" 功能（通常仅限群主/管理员使用，有使用频率限制，防止滥用）。
* **群文件共享与管理:**
    * 群成员可以上传文件到群共享空间（若开启此功能）。
    * 提供统一的群文件列表界面，支持按文件名、上传者、上传时间、文件类型排序和搜索。
    * 群文件总容量限制和单个文件大小限制。群主/管理员可管理（删除）群文件。
* **群内昵称设置:**
    * 群成员可以为自己在特定群组内设置不同于全局昵称的群昵称，该昵称仅在该群内显示。群主/管理员可修改他人群昵称。
* **查看群成员列表:**
    * 显示所有群成员的头像、昵称（或群昵称）、用户ID、群内身份（群主、管理员）、在线状态（可选）、加入时间等。
    * 支持按加入时间、昵称首字母等排序，支持搜索群成员。
* **群组搜索与发现 (可选):**
    * 允许用户按群ID、群名称、群标签等搜索公开的或允许被搜索的群组。

**(c) 消息特性**

* **消息发送状态指示:**
    * **发送中 (Sending):** 消息正在尝试通过网络发送到服务器（通常是动态图标，如小菊花旋转）。
    * **已发送至服务器 (Sent/Delivered to Server):** 消息已成功送达IM服务器（通常是单勾✓）。
    * **对方已送达 (Delivered to Recipient - 主要用于1-to-1):** 消息已成功推送到接收方至少一个在线设备（通常是双勾✓✓，未着色）。此状态依赖接收方客户端的确认。
    * **对方已读 (Read Receipt - 主要用于1-to-1):**
        * 接收方已打开聊天窗口并看到（或焦点在）该消息（通常是双勾✓✓，并着色，如蓝色）。
        * 用户可在隐私设置中选择是否发送/接收已读回执。若关闭，则双方均无法看到对方的已读状态。
        * **群聊已读状态:** 可选功能，显示有多少人已读某条消息，或具体哪些人已读（点击可查看列表）。此功能对服务器和客户端性能有较高要求，尤其在大群中。
    * **发送失败 (Failed):** 消息因网络问题、服务器错误或其他原因未能成功发送，显示明显错误标记（如红色感叹号），并提供重试选项。
* **消息撤回 (Recall/Unsend):**
    * 发送方可以在消息发送后的特定时间限制内（如2分钟、5分钟，可配置）撤回已发送的消息（文本、图片、语音、文件等）。
    * 撤回操作对发送方和所有接收方（包括多设备）均生效。
    * 撤回后，原消息位置会显示“XXX 撤回了一条消息”的提示。
    * 超过时限、对方已对消息进行特定操作（如红包已领取）、或消息类型不支持撤回（如系统通知）则无法撤回。
* **消息转发 (Forward):**
    * 用户可以将单条或选择多条消息转发给其他一个或多个好友/群组。
    * 支持逐条转发（原始消息逐条发送）或合并转发（多条消息打包成一条特殊消息发送，接收方可展开查看）。
    * 转发时可选择是否附带留言。
    * 转发时应注意保护原始发送者隐私（如匿名转发选项）。
* **消息引用回复 (Reply/Quote):**
    * 用户可以选择聊天记录中的某条特定消息（文本、图片、语音等）进行引用，并在其基础上进行回复。
    * 引用的消息会以卡片或缩略形式展示在回复消息的上方，清晰指示回复的上下文。
    * 点击引用的消息部分，可以快速跳转到原始消息在聊天记录中的位置。
* **聊天记录同步与漫游 (Chat History Sync & Roaming):**
    * **多端同步:** 用户在不同设备（手机、电脑、平板、Web端）上登录同一账户时，聊天记录（包括消息内容、状态、收发时间等）应保持实时或准实时同步。
    * **云端存储:** 聊天记录（文本、媒体元数据等，媒体文件本身可按需下载）安全加密存储在云端服务器。
    * **历史记录漫游:** 新设备登录后，可以自动或手动拉取最近一段时间的聊天记录（如近30天、近100条）或全部可漫游的历史记录（取决于存储策略和用户设置）。
    * 用户可选择是否开启云端同步功能，以及同步的内容范围（如仅文本，或包含图片/文件元数据）。
    * 本地缓存策略：在设备本地缓存一部分聊天记录，以优化加载速度和支持离线查看。
* **消息搜索:**
    * **全局搜索:** 在应用内提供入口，允许用户在所有聊天记录、联系人、群组中搜索关键词。结果分类展示。
    * **会话内搜索:** 在当前打开的聊天窗口内搜索关键词，高亮显示匹配的消息，并提供上/下一个匹配项的导航。
    * 支持按消息类型（如图片、视频、文件、链接、交易）、发送者、日期范围（如按月份查找）进行高级搜索和筛选。
* **草稿箱 (Drafts):**
    * 用户在某个聊天会话的输入框中输入了内容但未发送，在切换到其他会话或关闭应用（非强制）时，该内容应自动保存为草稿。
    * 在聊天列表或对应会话的输入框旁应有明显提示（如“[草稿]”字样），用户再次进入该会话时，草稿内容自动填充到输入框。
* **消息免打扰 (Do Not Disturb - Per Conversation):**
    * 用户可以为特定的好友聊天或群组聊天单独设置消息免打扰模式。
    * 在该模式下，该会话的新消息将不再触发声音和震动提醒（除非被@），但消息仍会正常接收并在聊天列表显示未读角标。
* **置顶聊天 (Pin Conversation):**
    * 用户可以将重要的好友聊天或群组聊天固定显示在聊天列表的最上方，方便快速访问，不受新消息排序影响。支持置顶多个会话。
* **消息清空/删除:**
    * **删除单条或多条消息:** 用户可以选择删除自己发送或接收的特定消息。可选择“仅为我删除”（本地删除）或“为所有人删除”（若在可撤回时间内，则等同于撤回；若超过，则可能仅本地删除或不允许）。
    * **清空聊天记录:** 用户可以清空与某个好友或群组的全部本地聊天记录。可选择是否同时删除云端记录（若有）。
* **“对方正在输入...”提示 (Typing Indicator):**
    * 当对方在与你的聊天窗口中输入文字时，实时显示“对方正在输入...”或类似动画提示，增加聊天的即时互动感。
    * 用户可在隐私设置中选择是否向对方发送自己的“正在输入”状态。
* **阅后即焚消息 (Ephemeral/Disappearing Messages - Optional):**
    * 用户可以发送设置为在对方阅读后的一定时间（如5秒、1分钟、1小时、1天）自动销毁的消息。
    * 此功能通常用于增强私密性的聊天场景。系统会尽力阻止或提示截图行为，但无法完全禁止。
    * 发送方和接收方界面都会显示消息的剩余可见时间或特殊标记。
* **消息翻译 (In-app Translation - Optional):**
    * 对接收到的外语消息（或用户选择的任何消息）提供一键翻译功能，翻译结果直接显示在原消息下方或替换原消息（可切换）。需集成翻译API。
* **消息收藏 (Favorite Messages):**
    * 用户可以将重要的消息（文本、图片、语音、文件、链接等）收藏起来，方便日后查找。
    * 提供统一的收藏夹入口，支持对收藏内容进行搜索、分类、管理。
* **链接预览 (Link Previews / Rich Link Previews):**
    * 当消息中包含URL时，系统自动抓取链接页面的标题、描述和缩略图，生成一个内容更丰富的卡片式预览，提升可读性。用户可选择是否为特定链接生成预览。

### 4. 联系人与关系链管理 (Contact & Relationship Management)

此模块负责管理用户的社交图谱，包括好友的发现、添加、组织和维护，是社交功能的基础。

**(a) 好友搜索与添加**

* **通过唯一ID/精准账号搜索:** 用户输入对方的精确用户ID、登录手机号或邮箱进行搜索。这是最准确的查找方式。
* **通过昵称搜索:** 用户输入对方昵称进行模糊搜索。由于昵称可能不唯一，系统可能返回多个匹配结果，按相关度排序，并显示头像、地区等辅助信息供用户辨识。
* **扫码添加好友:** 扫描对方分享的个人二维码名片，直接跳转到该用户的资料页或好友请求发送界面。
* **通过群组添加:** 在共同所在的群组中，点击群成员列表中的某个成员头像或其发送的消息中的头像，可以查看其资料并发起好友请求。
* **通过名片推荐添加:** 接收好友A分享的好友B的名片消息，点击名片可直接向B发起好友请求。
* **通讯录匹配与推荐 (Contacts Upload & Matching - Optional):**
    * 用户首次使用或在设置中主动授权应用读取设备通讯录权限。
    * 应用将通讯录中的手机号/邮箱（需进行哈希等脱敏处理后上传）与IM系统用户数据库进行匹配。
    * 向用户推荐其通讯录中已注册本IM服务但尚未成为好友的联系人。
    * 需严格遵守隐私法规，明确告知用户数据用途，提供关闭此功能的选项，并确保数据传输和存储的安全性。
* **附近的人 (People Nearby - Optional, 需谨慎设计以保护隐私和安全):**
    * 用户主动开启此功能并授权精确地理位置后，可以发现附近（一定距离范围内，如1公里）同样开启此功能的其他用户。
    * 列表通常按距离排序，显示对方头像、昵称、距离、性别、个性签名等。
    * 用户可随时关闭此功能，清除自己的位置信息。
    * 需有防骚扰机制和举报功能。
* **摇一摇/雷达加好友 (Shake/Radar Add Friends - Optional, 趣味性功能):**
    * 通过特定手势（如摇晃手机）或进入特定界面，匹配同时进行此操作的其他用户。
* **添加好友请求流程:**
    * 搜索到用户或通过其他途径找到用户后，点击“添加好友”按钮。
    * 系统会检查对方的隐私设置（是否允许被添加，是否需要验证）。
    * 发送好友请求时，用户可以（或被要求）填写验证信息/打招呼（有字数限制）。
    * 请求发送后，对方会收到好友请求通知。在对方处理前，发送方界面会显示“请求已发送”或类似状态。

**(b) 好友请求处理**

* **好友请求通知与列表:**
    * 当收到新的好友添加请求时，在专门的通知入口（如“新的朋友”或“联系人请求”）显示红点或数量提示。
    * 请求列表清晰展示所有待处理的好友请求，包含请求者头像、昵称、验证信息、请求时间、来源（如通过群聊添加、通过手机号搜索添加）。
* **处理操作选项:**
    * **同意 (Accept):** 双方正式建立好友关系。同意后，对方会收到“XXX已同意你的好友请求”的通知，双方好友列表会更新，可以开始聊天。可选择为新好友设置备注、分组。
    * **拒绝 (Decline/Ignore):** 拒绝该好友请求。对方通常不会收到明确的“被拒绝”通知，其发送的请求状态可能变为“对方已忽略”或无变化。
    * **忽略 (Later):** 暂时不处理该请求，请求仍保留在列表中。
    * **添加至黑名单并拒绝 (Decline & Block):** 拒绝请求，并将该用户同时加入自己的黑名单，防止其再次发送请求或通过其他方式骚扰。
* **已发送请求管理:** 用户可以查看自己已发送但对方尚未处理的好友请求列表，并可选择撤销某个请求（若对方未处理）。
* **请求过期机制:** 好友请求在一定时间（如7天、30天）未被处理，则自动标记为已过期或从列表中移除（可选）。

**(c) 好友列表展示、好友备注、好友分组**

* **好友列表展示:**
    * 以列表形式清晰展示所有已添加的好友。
    * 每项显示好友头像、昵称（优先显示备注名）、个性签名（可选）、在线状态（可选，根据隐私设置）。
    * 支持按昵称（或备注名）的字母顺序（拼音/英文）进行排序。
    * 提供快速滚动条和A-Z字母索引导航，方便快速查找。
    * 可显示好友总数。
    * 支持按自定义分组折叠/展开显示。
* **好友备注 (Alias/Remark Name):**
    * 用户可以为每个好友设置一个备注名，该备注名仅自己可见，用于更好地区分和识别好友（尤其当好友昵称相似或不熟悉时）。
    * 设置备注名后，在好友列表、聊天界面等处将优先显示备注名。
    * 支持对备注名进行搜索。
* **好友分组 (Friend Groups/Tags):**
    * 用户可以创建自定义的好友分组（如“家人”、“同事”、“同学”、“项目A组成员”等）。
    * 可以将好友灵活地归入一个或多个分组（若使用标签式分组）。
    * 支持对分组进行创建、重命名、删除、排序等操作。
    * 在好友列表中可以按分组查看好友。
    * 可针对整个分组进行某些批量操作（如群发消息的前置选择，或设置朋友圈权限）。
* **特别关心/星标好友 (Starred/Favorite Friends):**
    * 用户可以将重要的好友标记为“特别关心”或“星标好友”。
    * 这些好友可以在好友列表中置顶显示（在一个特殊的分组内），或者其消息通知有特殊提示音/震动模式，或者其动态更新优先推送。

**(d) 好友关系管理**

* **删除好友 (Unfriend/Delete Contact):**
    * 用户可以单方面解除与某个好友的好友关系。
    * 操作后，对方会从自己的好友列表中消失，自己也会从对方的好友列表中消失（即关系是双向解除的）。
    * 删除好友后，双方的聊天记录通常在本地保留（除非用户选择同时清除），但无法再向对方发送消息（除非重新添加）。
    * 可选：删除好友时，是否同时将对方加入黑名单，或是否清空与对方的聊天记录。
* **屏蔽好友/加入黑名单 (Block User):**
    * 用户可以将某个用户（无论是否为好友）加入黑名单。
    * 加入黑名单后：
        * 自己将不再收到来自该用户的任何消息、音视频通话请求、好友请求等。
        * 对方发送消息时，其界面可能提示“消息已发送，但被对方拒收”或无任何异常提示（消息石沉大海）。
        * 双方通常互相看不到对方的在线状态、个性签名更新、朋友圈/动态更新等。
        * 对方无法再通过搜索等方式向自己发起好友请求。
    * **黑名单管理:** 在设置中提供黑名单列表，用户可以查看所有已拉黑的用户，并可选择将某个用户移出黑名单（解除屏蔽），解除后关系恢复到拉黑前的状态（若是好友则恢复好友关系，若非好友则仍非好友但可重新发起请求）。
* **举报好友/用户 (Report User):**
    * 当用户认为某个好友或陌生用户发布了违规内容（如色情、暴力、欺诈、广告骚扰等）或有不当行为时，可以向平台发起举报。
    * 举报时需要选择举报原因（预设类别），并可附带相关的聊天记录截图、文字说明等证据。
    * 平台后台会有专门的团队审核处理举报，并根据情况对被举报用户采取相应措施。举报者会收到处理结果的反馈（可选）。
* **好友权限设置 (Fine-grained Permissions Per Friend):**
    * 针对特定的好友，可以设置更细致的隐私权限，例如：
        * **朋友圈/动态权限:** “不让他看我的朋友圈/动态”、“不看他的朋友圈/动态”。
        * **聊天消息权限:** （较少见，但理论上可设计）如“接收但不提醒他的消息”（类似单独的免打扰）。
        * **音视频通话权限:** “不允许他向我发起音视频通话”。
        * **资料可见性:** 覆盖全局设置，单独为此好友设置某些个人资料的可见性。

### 5. 实时音视频通话 (Real-time Audio/Video Communication)

此模块利用 WebRTC (Web Real-Time Communication) 或其他类似的实时通讯技术栈（如自研基于RTP/RTCP的方案），提供高质量、低延迟的语音和视频通讯服务。

**(a) 一对一语音通话与视频通话**

* **发起通话:**
    * 在与好友的聊天界面顶部、或联系人资料页、或通过快捷操作（如长按联系人）点击语音通话或视频通话按钮。
    * 发起后，主叫方界面显示为呼叫等待状态，清晰展示对方头像、昵称，并播放呼出等待音。
* **接听/拒接通话:**
    * 被叫方会收到系统级的来电提醒界面（即使App在后台运行或设备处于锁屏状态，通过VoIP推送或高优先级数据推送实现）。
    * 来电界面显著显示主叫方头像、昵称，以及“滑动接听”、“点击接听”、“拒接”、“稍后提醒”、“通过短信快捷回复并拒接”等操作按钮。
    * 若被叫方正在与其他用户通话中，系统应提示主叫方“对方忙线中”，并通知被叫方有新的呼入（呼叫等待功能，被叫方可选择保持当前通话并拒接新来电、结束当前通话并接听新来电、或让新来电等待）。
* **通话中界面 (语音通话):**
    * 清晰显示对方头像（或通话背景）、昵称、实时通话时长。
    * 核心功能按钮：
        * **静音/取消静音麦克风 (Mute/Unmute):** 控制自己的麦克风输入。
        * **开启/关闭扬声器 (Speakerphone On/Off):** 切换音频输出设备。
        * **切换到视频通话 (Switch to Video Call):** 向对方发起升级为视频通话的请求，对方同意后切换。
        * **保持/恢复通话 (Hold/Resume - 可选):** 临时暂停通话，双方都听不到对方声音，可恢复。
        * **添加成员 (Add Participant - 可选，将1v1通话升级为多人通话):** 邀请其他人加入当前通话。
        * **挂断 (End Call):** 结束通话。
* **通话中界面 (视频通话):**
    * 默认显示对方的视频画面为主画面（大屏），自己的视频画面为一个小窗（画中画，可拖动位置，可点击切换主副画面）。
    * 清晰显示实时通话时长。
    * 核心功能按钮：
        * **静音/取消静音麦克风 (Mute/Unmute):**
        * **关闭/开启本地摄像头 (Stop/Start Video):** 停止或开始发送自己的视频画面，关闭后对方看到的是你的头像或黑屏。
        * **切换前后置摄像头 (Switch Camera):** 在移动设备上。
        * **切换到纯语音通话 (Switch to Voice Call):** 关闭双方视频画面，仅保留语音。
        * **截屏/录制 (Screenshot/Record - 可选，需提示对方):** 截取当前通话画面或录制通话过程。
        * **美颜/滤镜 (Beauty Filters/Effects - 可选):** 提供实时视频美化效果。
        * **挂断 (End Call):**
* **通话质量实时提示:**
    * 根据当前网络状况（如带宽、延迟、丢包率），在通话界面实时显示通话质量指示（如信号格、文字描述“网络良好/一般/较差”、或具体参数）。
    * 当网络状况极差时，系统可自动尝试降低视频分辨率/帧率或音频码率，或提示用户切换网络环境。
* **未接来电与通话记录:**
    * 若通话未被接听、被拒、或因网络问题中断，主叫方和被叫方都会在与对方的聊天记录中看到一条通话记录（如“未接来电”、“已拒接”、“通话时长XX:XX”、“通话取消”）。
    * 应用内有专门的“通话记录”列表，汇总所有语音和视频通话历史，包含类型（呼出/呼入/未接）、对方信息、通话时间、通话时长。点击记录可快速回拨或查看联系人资料。

**(b) 多人语音通话与视频会议**

* **发起方式:**
    * 从群聊资料页或聊天界面发起群组通话（邀请群内部分或全部在线成员）。
    * 在主界面选择“发起通话”，然后从联系人中选择多个成员直接发起多人通话。
* **邀请成员:**
    * 在多人通话进行过程中，已在通话中的成员（或仅限主持人/管理员）可以继续邀请更多在线好友或群成员加入。
    * 被邀请者收到与一对一通话类似的来电通知。
* **成员管理 (通常由通话发起者或指定主持人/管理员操作):**
    * **全体静音/解除全体静音 (Mute/Unmute All):** 主持人可将所有其他参会者静音。
    * **单独静音/请求开启麦克风 (Mute/Ask to Unmute Specific Member):**
    * **单独关闭/请求开启视频 (Stop/Ask to Start Video Specific Member):**
    * **将某成员移出通话 (Remove Participant):**
    * **设置/取消联席主持人 (Assign/Revoke Co-host - 可选):** 赋予其他成员部分管理权限。
    * **转让主持人权限 (Transfer Host Role - 可选):**
    * **锁定会议 (Lock Meeting - 可选):** 阻止新成员加入。
* **界面布局 (视频会议):**
    * **网格视图 (Grid View):** 平均分配屏幕空间显示各参会者的视频画面（当人数较多时，可能分页或显示部分）。
    * **演讲者视图 (Active Speaker View):** 自动突出显示当前正在发言的人的视频画面为主画面。
    * **焦点视图 (Pinned/Spotlight View):** 主持人可以指定某个或某几个参会者的视频始终占据主画面。
    * 参会者列表：侧边栏或弹窗显示所有参会者的头像、昵称、麦克风/摄像头状态，以及是否举手等。
* **人数上限:** 根据系统架构、服务器能力和产品定位设定（如9人、25人、100人，甚至更多，可能区分普通通话和大型会议模式）。
* **会议预约与提醒 (可选，更偏向会议产品):**
    * 支持用户预约未来的多人通话/视频会议，设置会议主题、时间、参会人，并向参会人发送日历邀请和到时提醒。

**(c) 通话中的通用功能**

* **静音/取消静音 (Mute/Unmute Microphone):** 控制自己的麦克风是否采集和发送音频。
* **开启/关闭摄像头 (Start/Stop Video):** 控制自己的摄像头是否采集和发送视频。
* **切换前后置摄像头 (Switch Camera):** 在移动设备上，方便切换拍摄对象。
* **扬声器/听筒/蓝牙设备切换 (Audio Output Routing):** 允许用户选择音频输出设备。
* **屏幕共享 (Screen Sharing):**
    * 桌面端和移动端（部分系统支持）均可支持。
    * 用户可以选择分享整个桌面、特定的应用程序窗口、或浏览器中的某个标签页。
    * 接收方可以实时观看到共享的屏幕内容。
    * 屏幕共享时应有清晰的指示（如屏幕边缘有色框），并注意隐私保护（如隐藏通知）。
    * 可选择是否同时共享系统声音。
* **通话质量实时显示与自适应调整:**
    * 显示当前连接质量指标（如延迟、抖动、丢包率、可用带宽）。
    * 系统应能根据网络状况动态调整音视频的编码参数（如分辨率、帧率、码率），以优先保证通话的流畅性和基本可听/可视性 (Adaptive Bitrate Streaming, Simulcast, SVC等技术)。
* **背景虚化/虚拟背景 (Video Background Effects - Optional):**
    * 在视频通话中，利用AI算法对用户身后的真实背景进行模糊处理，或替换为用户选择的图片/短视频作为虚拟背景。
* **美颜滤镜 (Beauty Filters - Optional):**
    * 提供实时的磨皮、美白、瘦脸等美颜效果，或趣味AR滤镜。
* **文字聊天/互动表情 (In-Call Text Chat / Reactions - Optional):**
    * 在音视频通话界面内嵌一个简易的文字聊天窗口，方便在不打断语音的情况下发送文本信息、链接、或共享临时文件。
    * 允许参会者发送Emoji“反应”（如点赞、鼓掌、爱心），这些反应会临时显示在发送者视频窗口或屏幕上。
* **录制通话/会议 (Recording - Optional, 需严格遵守法律合规和用户同意原则):**
    * 主持人或授权用户可选择在云端或本地录制整个通话/会议的音频和视频内容。
    * 开始录制前，必须明确通知所有参会者通话正在被录制，并获得其同意（或提供明确的退出选项）。录制状态应在界面上清晰可见。
* **举手发言 (Raise Hand - 主要用于多人会议):**
    * 参会者可以通过点击“举手”按钮示意主持人自己想要发言，主持人可以在参会者列表中看到举手状态并按序安排发言。
* **共享白板 (Shared Whiteboard - Optional):**
    * 提供一个虚拟的共享白板，所有（或授权的）参会者可以在上面进行绘制、书写、粘贴图片等协作操作，用于头脑风暴或演示。
* **轮询/投票 (Polling - Optional, 主要用于多人会议):**
    * 主持人可以发起临时的单选或多选投票，收集参会者意见。

### 6. 通知与提醒 (Notification & Reminder System)

确保用户不会错过重要信息（如新消息、好友请求、系统公告等），同时提供灵活的自定义选项以避免不必要的打扰，并遵从操作系统的通知规范。

**(a) 新消息通知**

* **通知触发时机:** 当App处于后台或用户未在当前聊天界面时，收到新消息后触发。
* **通知呈现方式 (根据系统及用户设置):**
    * **声音提醒 (Sound Alert):** 播放用户选定或系统默认的通知音效。
    * **震动提醒 (Vibration Alert):** 设备按用户设定的震动模式进行震动。
    * **弹窗/横幅通知 (Popup/Banner Notification):**
        * **App 在前台但非当前聊天界面:** 应用内顶部/中部弹出简短通知条。
        * **App 在后台或设备锁屏:** 利用操作系统提供的推送服务（如APNS, FCM/HMS Push）显示系统级横幅通知。通知内容通常包含发送者头像、昵称（或群名称+发送者昵称）、消息摘要（如部分文本内容，或“[图片]”、“[语音]”等类型提示）。
    * **锁屏通知:** 在设备锁屏界面显示通知摘要，用户可设置锁屏通知的详细程度（显示内容、隐藏内容、或不显示）。
    * **应用图标角标/徽章提醒 (Badge App Icon):** 在应用图标的右上角显示未读消息总数或一个红点。
* **通知内容定制:**
    * 对于私聊消息，显示发送者昵称和消息预览。
    * 对于群聊消息，显示群名称、发送者昵称和消息预览。
    * 对特殊消息类型（图片、语音、视频、文件、位置等）在预览中进行标识。
* **通知聚合与分组 (Notification Grouping/Stacking):**
    * 当短时间内收到来自同一用户或同一群组的多条消息时，系统应将这些通知聚合成一条通知（例如，在Android中表现为通知组，iOS中自动堆叠）。
    * 聚合通知应显示发送者/群组名称以及未读消息数量（如“张三：[3条新消息]”或“技术交流群：[5条新消息]”）。
    * 用户展开聚合通知后，可以看到各条独立消息的摘要。
* **快速回复/操作 (Quick Actions - 需操作系统支持):**
    * 在通知横幅或锁屏通知上，直接提供“回复”输入框（允许用户不打开App即快速回复简单文本）、“标记为已读”、“静音该会话”等快捷操作按钮。
* **智能通知 (Smart Notifications - 可选高级功能):**
    * 基于用户行为和消息重要性（如是否被@、是否来自特别关心好友、消息内容关键词等）对通知进行优先级排序或智能摘要。
    * 例如，在用户设置的“专注模式”下，仅高优先级通知才会发出声音/震动。

**(b) 各类请求与系统通知**

除了新聊天消息，系统还需对以下重要事件进行通知：

* **好友请求通知:**
    * 当收到新的好友添加请求时，应发出明确通知。
    * 通知内容包含请求者的头像、昵称和验证信息摘要。点击通知可直接跳转到好友请求处理列表。
* **音视频通话来电通知:**
    * 收到音视频通话邀请时，触发强提醒（通常是全屏或顶部持久横幅的来电界面）。
    * 即使在应用静音或系统勿扰模式下，也可能允许来电响铃（用户可配置此行为，或遵从系统对VoIP通话的特殊处理）。
    * 通知包含主叫方信息及接听/拒接等操作。
* **@提及通知 (Mention Notifications):**
    * 在群聊中，如果用户被其他成员通过“@昵称”或“@全体成员”提及，即使该群聊被设置为消息免打扰，用户也应收到一条明确的、可能带有特殊提示音的通知。
    * 通知内容应清晰指出哪个群的谁@了你。
* **群公告通知:**
    * 当群主或管理员发布新的群公告，或更新重要群公告时，应通知所有群成员。
    * 通知可引导用户直接查看公告内容。
* **系统通知/运营通知:**
    * 来自应用官方的重要信息，如版本更新提示、功能上线介绍、服务条款或隐私政策变更通知、账户安全警告、官方活动推广等。
    * 这类通知通常有专门的“系统通知”、“服务助手”或“运营消息”会话入口，并可能使用不同的通知音效或样式。
* **其他重要事件通知:**
    * 文件发送/接收成功或失败的通知。
    * 账号在非常用设备或异地登录成功的安全提醒。
    * 密码修改成功、绑定手机/邮箱变更成功的确认通知。
    * 用户举报反馈处理结果通知。
    * 日程或待办事项的到期提醒（若集成此类功能）。

**(c) 通知自定义设置**

提供丰富的选项，允许用户根据个人偏好和使用场景精细化管理通知行为。

* **全局通知总开关:**
    * 一个总开关，允许用户一键开启或关闭应用的所有通知。
* **新消息通知类型开关:**
    * 分别控制是否接收私聊消息通知、群聊消息通知。
* **声音提醒设置:**
    * **开启/关闭新消息声音:**
    * **通知铃声选择:** 允许用户为私聊消息、群聊消息、系统通知等不同类型的通知选择不同的内置铃声，或使用系统默认铃声，甚至自定义上传铃声（可选）。
* **震动提醒设置:**
    * **开启/关闭新消息震动:**
    * **震动模式选择:** （若系统支持）允许用户选择不同的震动模式。
* **特定会话免打扰 (Mute Conversation / Do Not Disturb per Chat):**
    * 用户可以为单个好友聊天或群聊单独设置“消息免打扰”模式。
    * 开启后，该会话的新消息将不再触发声音和震动提醒（除非被特别@），但消息仍会正常接收并在聊天列表显示未读角标。
    * 可选择免打扰时长（如1小时、8小时、直到我取消）。
* **通知内容显示级别 (Notification Detail Level):**
    * **锁屏通知设置:** 用户可选择在设备锁屏状态下：
        * 显示发送人和消息内容摘要。
        * 仅显示发送人信息，隐藏内容摘要。
        * 完全不显示通知。
    * **横幅通知预览内容:** 是否在通知横幅中显示消息预览。
* **时段免打扰 (Scheduled Do Not Disturb / Quiet Hours):**
    * 用户可以设置一个或多个固定的时间段（如工作日夜间23:00 - 次日07:00，周末全天），在此期间所有（或指定类型的）通知将自动静默（无声音、无震动，可能也无横幅）。
* **通知渠道管理 (Notification Channels - 针对Android O及以上版本):**
    * 充分利用操作系统提供的通知渠道功能，将不同类型的通知（如私聊消息、群消息、@提及消息、音视频通话邀请、文件传输通知、系统更新通知等）划分到不同的渠道。
    * 用户可以在系统设置中针对每个渠道独立配置其重要性级别、是否允许发出声音、是否允许震动、是否在锁屏显示、是否覆盖勿扰设置等。
* **应用图标角标管理 (App Icon Badge Settings):**
    * 选择是否在应用图标上显示角标。
    * 角标内容：仅显示红点，或显示未读消息总数。
    * 可选择哪些类型的未读内容计入角标（如仅聊天消息，或包括好友请求等）。
* **“特别关心”好友通知强化:**
    * 对于标记为“特别关心”的好友，其发来的消息可以有独特的通知铃声或震动模式，甚至在某些勿扰模式下也能穿透提醒（用户可配置）。

#### 通知类型与定制选项

| 事件                   | 默认行为                   | 用户定制选项                | 主要传递渠道           |
|------------------------|----------------------------|-----------------------------|------------------------|
| 一对一消息             | 声音+振动+横幅/推送        | 静音、自定义提示音等        | 推送、横幅、声音、振动 |
| 群消息                 | 声音+振动+横幅/推送        | 静音、仅@提及、自定义提示音 | 推送、横幅、声音、振动 |
| 群聊@提及              | 强提醒+横幅/推送           | 通常不可完全关闭            | 推送、横幅、声音、振动 |
| 消息回应               | 轻微提示                   | 可关闭                      | 应用内、可选推送       |
| 好友请求               | 横幅/推送                  | 可调整提醒方式              | 推送、应用内           |
| 音视频通话邀请         | 持续响铃+全屏/高优推送      | 不可静音，可设不同铃声      | 推送、全屏界面         |
| 联系人动态             | 可选静默推送/应用内提示     | 可关闭特定动态通知          | 推送、应用内           |
| 系统公告/重要更新      | 横幅/推送                  | 通常不可关闭                | 推送、消息中心         |

---

### 7. 设置与其他辅助功能 (Settings & Other Auxiliary Functions)

提供个性化配置和实用工具，增强软件的易用性、可访问性和用户满意度。

**(a) 外观设置 (Appearance Settings)**

* **主题模式 (Theme Mode):**
    * **浅色模式 (Light Mode):** 默认的标准界面主题。
    * **深色模式 (Dark Mode / Night Mode):** 提供以暗色调为主的界面，有助于在弱光环境下减轻眼部疲劳，并可能在OLED屏幕设备上节省电量。
    * **跟随系统 (System Default):** 应用主题自动跟随当前操作系统的浅色/深色模式设置。
    * **自定义主题颜色 (Optional):** 允许用户选择应用的主色调或强调色。
* **字体大小 (Font Size):**
    * 提供多档预设的全局字体大小选择（如小、标准、中、大、特大），以适应不同用户的视力需求和阅读偏好。
    * 应用内所有主要界面的文本（聊天内容、列表文字、菜单文字等）均应随之调整。
* **聊天背景 (Chat Background):**
    * **全局聊天背景:** 允许用户为所有聊天会话设置统一的背景图片或纯色背景。
    * **单个聊天背景:** 允许用户为特定的好友聊天或群聊单独设置聊天背景。
    * 提供一组内置的背景图片库供用户选择，同时支持用户从设备相册选择自定义图片作为背景。
    * 背景图片可设置模糊度或透明度，以确保聊天内容的可读性。
* **气泡样式/颜色 (Chat Bubble Style/Color - Optional):**
    * 允许用户选择不同的聊天气泡（对话框）样式、颜色主题或透明度。
* **列表密度 (List Density - Optional):**
    * 允许用户调整列表项（如聊天列表、联系人列表）的显示密度（紧凑、标准、宽松），以在信息密度和易操作性之间取得平衡。

**(b) 隐私设置 (Privacy Settings)**

此部分集中管理用户个人信息和行为的对外可见性与控制权。

* **加好友验证方式:**
    * **允许任何人添加我:** 其他用户无需验证即可直接将自己添加为好友。
    * **需要验证才能添加我 (默认):** 其他用户添加自己为好友时，自己会收到好友请求，需同意后才能建立关系。
    * **不允许通过以下方式添加我:**
        * 不允许通过我的手机号搜索到我。
        * 不允许通过我的用户ID/账号搜索到我。
        * 不允许通过我的邮箱搜索到我。
        * 不允许通过群聊将我添加为好友（除非是群主/管理员）。
        * 不允许通过名片推荐将我添加为好友。
* **朋友圈/动态/状态历史权限 (If applicable, for IMs with social feed/status features):**
    * **谁可以看我的朋友圈/动态/状态:**
        * 公开 (对所有用户，包括陌生人，若支持)。
        * 仅好友可见。
        * 私密 (仅自己可见)。
        * 部分好友可见 (通过“选择可见好友”白名单)。
        * 不给谁看 (通过“选择不可见好友”黑名单)。
    * **允许朋友查看朋友圈/动态/状态的范围:**
        * 最近三天。
        * 最近一个月。
        * 最近半年。
        * 全部。
    * **是否允许陌生人查看最近N条朋友圈/动态/状态。**
* **在线状态与输入状态隐私:**
    * **在线状态可见性:** 设置谁可以看到自己的“在线”、“忙碌”、“离开”等状态（所有人、仅好友、对特定人隐身）。
    * **“正在输入”提示开关:** 用户可以选择是否在自己输入时向对方显示“正在输入...”的提示。关闭后，自己通常也无法看到对方的输入状态。
* **已读回执开关 (Read Receipts):**
    * 用户可以选择是否向对方发送消息的“已读”状态。如果关闭，自己通常也无法看到对方是否已读自己的消息。此设置一般对私聊生效。
* **通讯录好友推荐设置:**
    * **是否允许应用访问通讯录以推荐好友。**
    * **是否允许其他人通过其通讯录匹配到我并向我发起好友推荐。**
* **个人资料对外可见性设置:**
    * 提供详细的列表，允许用户逐项设置其个人资料（如真实姓名、性别、地区、生日、职业、学校、邮箱、个性二维码等）对陌生人、好友的可见程度（完全可见、部分可见如仅显示星座、或完全隐藏）。
* **黑名单管理 (Blocked Users):**
    * 清晰列出所有已被自己加入黑名单的用户。
    * 支持将用户从黑名单中移除（解除屏蔽）。
* **数据与权限管理中心:**
    * **已授权限概览:** 清晰列出本应用已获取的操作系统敏感权限（如相机、麦克风、位置信息、存储空间读写、通讯录访问、日历访问、通知权限等）及其主要用途。
    * **权限修改快捷入口:** 提供跳转到操作系统对应权限设置页面的快捷链接，方便用户管理。
    * **个人信息副本导出/下载 (Data Portability):** 允许用户申请并下载其个人账户信息和主要数据的副本（如个人资料、联系人列表、消息历史元数据等，需符合GDPR等法规要求）。
    * **账户删除/注销 (Account Deletion / Right to be Forgotten):**
        * 提供清晰、易于操作的账户永久删除/注销流程。
        * 明确告知用户注销账户的后果（如数据将如何处理、是否可恢复等）。
        * 注销前可能需要进行身份验证和风险确认（如确认无未完成的交易、无重要数据未备份等）。
* **广告个性化设置 (If applicable):**
    * 如果应用内包含广告，应提供选项允许用户关闭或限制基于其个人数据和行为的个性化广告推荐。

**(c) 通用设置 (General Settings)**

包含应用的基础行为配置、数据管理及其他普适性功能。

* **多语言支持 (Language Settings):**
    * 应用界面应支持多种主流语言（如中文简体、中文繁体、英文、日文、韩文、西班牙文、法文、德文等，根据目标市场决定）。
    * 允许用户在应用内手动切换界面语言，或选择“跟随系统语言”自动适配。
* **存储空间管理 (Storage Management):**
    * **空间占用分析:** 清晰显示应用当前占用的总存储空间，并细分各项数据类型（如聊天记录缓存、图片缓存、视频缓存、语音消息、下载的文件、应用本身大小等）的占用情况。
    * **缓存清理 (Clear Cache):** 提供一键清理应用产生的各类临时文件和缓存数据（如图片缩略图、不再需要的旧文件片段等），以释放存储空间，同时不影响核心聊天记录。
    * **聊天记录清理:**
        * **按会话清理:** 允许用户选择特定好友或群聊，清空其全部或部分聊天记录。
        * **按时间范围清理:** 如清理所有早于一个月/三个月/一年的聊天记录。
        * **按文件类型清理:** 如批量删除聊天中已接收的图片、视频、大文件等（可按大小或时间筛选）。
    * **自动清理策略 (Optional):** 允许用户设置自动清理规则，如“自动清理超过N天的缓存图片/视频”、“当存储空间低于X时自动提示清理”等。
* **网络设置:**
    * **图片/视频自动下载选项:**
        * 在移动网络下：从不自动下载、仅自动下载小图、自动下载所有。
        * 在Wi-Fi网络下：从不自动下载、自动下载所有。
    * **文件自动下载选项:** 类似图片/视频，但可能更保守。
    * **流媒体播放设置:** 在移动网络下播放视频/音频时是否优先使用低码率。
    * **代理服务器设置 (Proxy Settings - Optional):** 允许用户配置HTTP/SOCKS5代理，用于在特定网络环境下连接IM服务器。
* **消息备份与恢复 (Chat Backup & Restore):**
    * **云端备份:**
        * 允许用户手动或设置自动（如每日、每周在Wi-Fi下且充电时）将聊天记录（主要是文本消息，图片/视频/文件等媒体内容可选择是否备份或仅备份元数据和链接）加密备份到用户自己的云存储服务（如iCloud Drive, Google Drive, OneDrive）或应用提供的安全云端。
        * 备份过程应有进度提示，并可设置备份密码（二次加密）。
    * **本地备份 (Optional):** 允许用户将聊天记录导出到设备本地存储的特定文件中。
    * **数据恢复:** 在新设备登录或应用重装后，引导用户从最近的云端备份或本地备份中恢复聊天记录。
* **键盘行为设置:**
    * **Enter键功能选择:** 设置Enter键是用于“发送消息”还是“换行”（另一功能则通过Shift+Enter或Ctrl+Enter实现）。
* **辅助功能快捷方式 (Accessibility Shortcuts - Optional):**
    * 为残障用户提供快速访问辅助功能（如屏幕阅读器优化、动态字体支持、高对比度模式等）的入口。

**(d) 帮助与反馈 (Help & Feedback)**

提供用户支持、问题解答和意见收集渠道。

* **常见问题解答 (FAQ / Help Center):**
    * 提供一个结构化、可搜索的知识库，包含对用户经常遇到的问题、功能使用方法、故障排除步骤等的图文解答。
* **用户手册/功能教程 (User Guide / Tutorials):**
    * 对应用的主要功能模块提供详细的使用指南或交互式教程，尤其是新功能上线时。
* **在线客服/机器人客服 (Online Support / Chatbot):**
    * 提供应用内联系人工客服的渠道（如通过专门的聊天会话或表单提交）。
    * 可先由智能机器人客服尝试解答常见问题，无法解决时再转接人工。
* **意见反馈 (Submit Feedback):**
    * 提供一个便捷的入口，允许用户提交对应用的问题报告（Bugs）、功能建议、使用体验评价等。
    * 反馈时可引导用户提供问题描述、复现步骤、相关截图/录屏、以及联系方式（可选）。
    * 可允许用户附带应用日志文件以帮助排查问题。
    * 用户提交反馈后，应能看到反馈状态（如已收到、处理中、已解决）或收到开发者的回复（可选）。
* **版本信息 (About):**
    * 显示当前应用的名称、Logo、版本号、构建号。
    * 提供“检查更新”功能，引导用户到应用商店或官网下载最新版本。
    * 包含指向服务协议（Terms of Service）、隐私政策（Privacy Policy）、开源组件许可（Open Source Licenses）等法律文档的链接。
    * 显示版权信息和开发者/公司信息。

### 8. 安全与隐私保护 (Security & Privacy Protection)

此模块是 IM 软件的生命线，通过技术和策略手段保护用户通讯内容、个人数据和账户的机密性、完整性和可用性，建立用户信任。

**(a) 消息加密方案**

* **传输层加密 (Encryption in Transit - TLS/SSL):**
    * **强制要求:** 客户端与服务器之间、以及服务器集群内部各组件之间的所有数据传输（包括登录凭证、个人资料、消息内容、文件、音视频信令及媒体流元数据等）均必须使用当前推荐强度（如TLS 1.2或TLS 1.3）的TLS/SSL协议进行加密。
    * **证书校验:** 客户端必须严格校验服务器证书的有效性、颁发机构和域名匹配，防止中间人攻击（Man-in-the-Middle, MITM）。可采用证书固定（Certificate Pinning）增强安全性。
* **端到端加密 (End-to-End Encryption - E2EE):**
    * **适用范围与可行性:**
        * **一对一聊天:** 强烈推荐为默认或可选的加密方式。消息内容从发送方设备加密，只有接收方设备才能解密，IM服务提供商也无法查看明文内容。常用成熟协议如Signal Protocol (Double Ratchet Algorithm, X3DH, etc.)。
        * **群组聊天:** E2EE 实现更为复杂，主要挑战在于大规模群组中的密钥管理（分发、成员变动时的密钥更新、新成员加入后对历史消息的访问等）。但技术上是可行的，如Signal、WhatsApp已实现基于发送者密钥的多播加密或成对会话的群组加密。
        * **音视频通话:** 也可以实现端到端加密，例如使用SRTP (Secure Real-time Transport Protocol) 配合DTLS-SRTP进行密钥交换，或在WebRTC中使用Insertable Streams API自定义E2EE。
    * **E2EE实现关键点:**
        * **安全密钥生成与管理:** 在用户设备本地安全地生成、存储和管理加密密钥。
        * **可靠的密钥交换协议:** 确保密钥在不被窃听的情况下安全交换。
        * **前向保密 (Forward Secrecy):** 即使长期密钥泄露，过去的会话密钥和消息内容仍然安全。
        * **后向保密 (Backward Secrecy / Post-Compromise Security):** 当前密钥泄露后，未来的会话密钥和消息内容应能恢复安全。
        * **多设备支持:** 用户在多个设备上使用E2EE时，需要安全的机制来同步密钥或消息（如一个设备解密后再加密转发给其他已验证设备）。
        * **用户身份验证/密钥验证:** 提供机制让用户可以验证对方的身份密钥（如通过扫描二维码或比对安全数字），确保没有发生MITM攻击。
        * **明确的E2EE状态标识:** 在用户界面上清晰地告知用户当前会话是否受到E2EE保护（如显示小锁图标）。
    * **用户体验与功能权衡:** E2EE可能会影响某些依赖服务器端访问消息内容的功能（如云端消息全文搜索、服务器端敏感内容过滤、消息漫游等）。需要在安全性和功能便利性之间做出权衡，或采用更复杂的技术（如可搜索加密、同态加密，但目前尚不成熟或性能开销大）。
* **服务器端数据静态加密 (Server-Side Encryption / Encryption at Rest):**
    * 对于未采用E2EE的消息、用户个人资料、联系人列表、文件以及其他存储在服务器上的敏感数据，均应在存储到数据库或文件系统之前进行强加密（如使用AES-256等标准算法）。
    * 加密密钥本身必须得到妥善管理，例如使用硬件安全模块 (HSM) 或专门的密钥管理服务 (KMS)。
    * 数据库字段级加密、文件级加密、磁盘级加密可分层使用。

**(b) 用户隐私数据保护机制**

遵循“隐私始于设计 (Privacy by Design)”和“默认隐私 (Privacy by Default)”原则。

* **数据最小化收集与使用原则 (Data Minimization):**
    * 仅收集为提供服务所绝对必需的用户数据。
    * 对于收集的每一项数据，都应有明确、合法的目的，并告知用户。
    * 数据的使用不应超出收集时声明的范围，除非获得用户额外同意。
* **匿名化 (Anonymization) 与假名化 (Pseudonymization) 处理:**
    * 在进行数据分析、用户行为研究、统计报告等场景时，应对用户身份信息进行彻底的匿名化处理，使其无法被重新识别到具体个人。
    * 对于某些仍需关联但又不宜直接使用身份标识的场景，可采用假名化技术。
* **严格的数据访问控制与审计:**
    * 建立基于角色的访问控制 (RBAC) 机制，确保只有经过授权的内部员工在履行其职责所必需时才能访问用户数据。
    * 所有对敏感用户数据的访问行为都应被详细记录（访问者、时间、访问内容、操作类型），并定期审计。
* **透明化的隐私政策与用户告知:**
    * 提供一份清晰、易懂、详尽的隐私政策，用平实的语言向用户解释：
        * 收集了哪些类型的个人信息。
        * 收集这些信息的目的和法律依据。
        * 信息如何被使用、存储、保护和保留。
        * 信息是否及如何与第三方共享。
        * 用户对其个人信息拥有的权利（访问、更正、删除、限制处理、可携带、反对等）。
        * 如何联系数据保护官 (DPO) 或隐私团队。
    * 隐私政策发生重大变更时，应通过显著方式（如应用内弹窗、邮件）及时通知用户，并可能需要用户重新同意。
* **用户数据权利的实现机制:**
    * 提供便捷的途径让用户行使其数据访问权、更正权、删除权（被遗忘权）、限制处理权、数据可携带权、拒绝权（如拒绝个性化推荐或营销）等。
* **第三方SDK和服务管理与审查:**
    * 审慎选择和集成任何第三方SDK、API或服务，对其数据安全和隐私保护能力进行严格评估和尽职调查。
    * 明确其数据收集范围、处理方式和隐私政策，确保其符合本应用的隐私标准和相关法规。
    * 定期审查第三方组件的安全性和合规性。
* **定期的安全审计、漏洞扫描与渗透测试:**
    * 聘请独立的第三方安全机构或内部安全团队对系统进行定期的全面安全审计、代码审查、漏洞扫描和模拟攻击（渗透测试），及时发现和修复潜在的安全漏洞和隐私泄露风险。
* **遵守全球与地方数据保护法律法规:**
    * 如欧盟的《通用数据保护条例》(GDPR)、美国的《加州消费者隐私法》(CCPA/CPRA)、中国的《个人信息保护法》(PIPL) 等，确保所有数据处理活动均符合适用的法律要求。
    * 针对不同地区的用户，可能需要提供差异化的隐私设置和数据处理方式。
* **数据泄露应急响应计划:**
    * 制定并演练数据泄露事件的应急响应预案，包括事件的发现、遏制、根除、恢复、评估、通知（监管机构和受影响用户）和事后改进等环节。

**(c) 举报与反垃圾机制 (Anti-Spam & Abuse Prevention)**

构建多层次的防御体系，以识别和处理垃圾信息、恶意行为和违规内容，维护健康的社区生态。

* **用户举报功能:**
    * 在用户资料页、聊天窗口（针对特定消息或用户）、群组信息页等处提供便捷、显眼的举报入口。
    * 用户举报时，应能选择清晰的举报原因/类别（如垃圾广告、欺诈骗钱、色情低俗、政治谣言、人身攻击、侵犯版权、恶意软件等）。
    * 允许用户附带文字说明和相关证据（如聊天记录截图、违规内容链接等）。
    * 举报信息应得到及时处理，并向举报者反馈处理结果（可选，或告知已收到并正在处理）。
* **自动化内容过滤与智能审查:**
    * **客户端初步过滤 (Optional):** 在用户输入端对已知的、非常明确的本地禁用词进行提示或阻止（主要用于防止误发，效果有限）。
    * **服务器端内容扫描与识别:**
        * **文本内容分析:** 基于关键词库、正则表达式、自然语言处理 (NLP) 模型、机器学习算法，识别垃圾广告、政治敏感词、辱骂威胁、色情文本、欺诈话术、诱导链接等。
        * **图片/视频内容识别:** 利用计算机视觉 (CV) 技术（如图像分类、物体检测、OCR、视频帧分析、哈希比对等）识别色情、暴力、血腥、恐怖、政治敏感图像/视频、二维码/水印中的恶意信息等。
        * **语音内容识别 (Optional):** 将语音消息转为文本后进行分析，或直接通过声纹分析识别特定类型的语音（如呻吟、广告录音）。
        * **链接安全检测:** 对消息中包含的URL进行扫描，识别钓鱼网站、恶意软件下载链接、博彩推广等。可集成第三方URL安全信誉库。
        * **文件安全扫描:** 对用户上传的文件进行病毒扫描和恶意代码检测。
* **行为模式分析与异常检测 (Behavioral Analysis):**
    * 基于用户行为数据（如注册行为、登录模式、消息发送频率/模式、好友添加行为、群组操作、举报/被举报历史等）建立用户行为画像和信誉评分系统。
    * 识别异常行为模式，如：
        * 短时间内大量注册相似账户（养号）。
        * 频繁在不同设备/IP地址登录，或使用代理/VPN。
        * 短时间内向大量陌生人发送相似内容的消息（群发广告）。
        * 频繁创建/加入群组并立即发布广告。
        * 被大量不同用户集中举报。
        * 发送大量包含特定高危关键词或短链接的消息。
    * 对检测到的异常行为，可触发进一步验证（如人机校验）或临时限制账户功能。
* **人机校验机制 (CAPTCHA & Similar):**
    * 在检测到可疑操作（如频繁尝试登录、发送消息过快、批量添加好友等）时，要求用户进行人机验证（如图形验证码、滑块验证、短信验证、语音验证、点选图中物体等），以区分真实用户和自动化脚本（Bots）。
* **人工审核与运营团队:**
    * 建立专业的内容审核和用户行为管理团队。
    * 负责处理用户举报、复核机器审核标记的高风险内容/行为、制定和更新审核规则、处理申诉等。
    * 审核平台应提供高效的工具，支持快速查看上下文、标记、处置、以及统计分析。
* **处罚与申诉机制:**
    * 根据违规行为的严重程度和用户历史记录，对确认违规的用户或内容采取梯度处罚措施：
        * 内容删除/屏蔽。
        * 警告提醒。
        * 暂时性功能限制（如禁止发言、禁止添加好友、禁止创建群组）。
        * 暂时性封禁账户（如1天、7天、30天）。
        * 永久性封禁账户。
        * 向执法机构报告（如涉及严重违法犯罪行为）。
    * 为被处罚用户提供清晰的申诉渠道和流程，确保申诉得到公正、及时的处理。
* **黑产对抗与情报共享:**
    * 持续关注和研究黑灰产的最新作弊手段和攻击模式，不断迭代和优化反垃圾策略。
    * 可考虑与行业内的其他公司或安全机构进行威胁情报共享。




#### 安全与隐私功能矩阵

| 功能ID | 功能                | 范围                | 默认状态   | 技术考量                      |
|--------|---------------------|---------------------|------------|-------------------------------|
| SEC001 | 多因素认证（MFA）   | 用户账户认证        | 可选启用   | TOTP/HOTP、短信、推送等        |
| SEC002 | 端到端加密（E2EE）  | 消息、文件、通话    | 默认启用   | Signal协议、密钥管理           |
| SEC003 | 传输层安全（TLS/SSL）| 所有网络通信        | 默认启用   | TLS1.2/1.3、证书管理           |
| SEC004 | 静态数据加密        | 服务器/客户端存储   | 默认启用   | AES-256、KMS                   |
| SEC005 | 用户隐私设置        | 资料、状态、回执等  | 部分默认   | 细粒度权限控制                 |
| SEC006 | 举报与审核工具      | 用户内容            | 始终可用   | 举报流程、审核后台             |
| SEC007 | 第三方组件与API安全 | 外部服务集成        | 持续评估   | 漏洞扫描、API网关、OAuth2      |
| SEC008 | 安全审计与漏洞扫描  | 整个系统            | 定期执行   | SAST、DAST、漏洞管理           |

---

## 三、数据库设计

本节将详细阐述即时通讯系统的数据库结构设计，包括数据需求分析、概念结构设计、逻辑结构设计、物理结构设计及数据库安全性设计等方面。

### 3.1 数据需求分析

在即时通讯系统中，核心数据对象主要包括用户、好友关系、消息记录、群聊、群成员、登录状态等。各对象之间关系紧密，需合理设计数据库结构以满足以下核心功能需求：

- 用户注册、登录与信息维护
    
- 单人聊天与群聊功能
    
- 好友管理功能
    
- 消息存储与状态跟踪（发送中、已发送、已读等）
    
- 群组创建、成员管理、群消息功能
    
- 离线消息存储与推送机制
    
- 会话历史记录查询与删除
    

### 3.2 概念结构设计

**实体：**

- 用户（User）
    
- 好友关系（Friendship）
    
- 消息（Message）
    
- 群聊（GroupChat）
    
- 群成员（GroupMember）
    
- 登录记录（LoginLog）
    

**主要关系：**

- 用户与好友：多对多（通过Friendship表示）
    
- 用户与消息：一对多（发送者和接收者）
    
- 群聊与成员：一对多（GroupChat对GroupMember）
    
- 群聊与消息：一对多（GroupChat对Message）
    

### 3.3 逻辑结构设计（数据库表设计）

下列为各个表的字段及说明：

---

#### 3.3.1 用户表（User）

|字段名|类型|描述|
|---|---|---|
|user_id|BIGINT PK|用户唯一ID|
|username|VARCHAR(50)|用户名|
|password|VARCHAR(100)|密码（加密存储）|
|nickname|VARCHAR(50)|昵称|
|avatar_url|TEXT|头像URL|
|email|VARCHAR(100)|邮箱|
|phone|VARCHAR(20)|手机号|
|status|INT|在线状态（0-离线,1-在线）|
|created_at|DATETIME|注册时间|
|updated_at|DATETIME|信息修改时间|

---

#### 3.3.2 好友关系表（Friendship）

|字段名|类型|描述|
|---|---|---|
|id|BIGINT PK|主键ID|
|user_id|BIGINT|用户ID|
|friend_id|BIGINT|好友ID|
|status|INT|好友状态（0-未验证，1-已添加）|
|remark|VARCHAR(100)|备注|
|created_at|DATETIME|添加时间|

---

#### 3.3.3 消息表（Message）

|字段名|类型|描述|
|---|---|---|
|message_id|BIGINT PK|消息ID|
|sender_id|BIGINT|发送者ID|
|receiver_id|BIGINT NULL|接收者ID（单聊时有效）|
|group_id|BIGINT NULL|群聊ID（群聊时有效）|
|content|TEXT|消息内容|
|message_type|INT|消息类型（文本、图片、文件等）|
|status|INT|状态（0-发送中，1-已发送，2-已读）|
|sent_time|DATETIME|发送时间|
|read_time|DATETIME NULL|阅读时间|

---

#### 3.3.4 群聊表（GroupChat）

|字段名|类型|描述|
|---|---|---|
|group_id|BIGINT PK|群聊唯一ID|
|group_name|VARCHAR(100)|群名称|
|owner_id|BIGINT|群主ID|
|description|TEXT|群简介|
|created_at|DATETIME|创建时间|

---

#### 3.3.5 群成员表（GroupMember）

|字段名|类型|描述|
|---|---|---|
|id|BIGINT PK|主键|
|group_id|BIGINT|群聊ID|
|user_id|BIGINT|用户ID|
|role|INT|成员角色（0-普通成员，1-管理员）|
|joined_at|DATETIME|加入时间|

---

#### 3.3.6 登录记录表（LoginLog）

|字段名|类型|描述|
|---|---|---|
|id|BIGINT PK|主键ID|
|user_id|BIGINT|用户ID|
|ip_address|VARCHAR(50)|登录IP地址|
|device_info|VARCHAR(255)|设备信息|
|login_time|DATETIME|登录时间|
|logout_time|DATETIME|登出时间|

---

### 3.4 物理结构设计

本系统采用MySQL数据库作为主要存储。所有主键使用自增ID或雪花ID以保证唯一性；大字段如`content`, `avatar_url`使用TEXT存储。表之间通过索引（如user_id, group_id）加速查询，支持高并发写入。

**索引策略：**

- 为用户表的 `username`, `email`, `phone` 添加唯一索引
    
- 为消息表的 `sender_id`, `receiver_id`, `group_id`, `sent_time` 添加联合索引以优化消息检索
    
- 为群成员表的 `group_id` 添加索引支持快速查找群用户
    

### 3.5 数据一致性与完整性约束

- 使用外键约束保证消息、好友关系、群聊成员的引用有效性
    
- 使用触发器或程序逻辑实现删除用户时自动清除其消息与好友关系
    
- 所有表均设置 `created_at`, `updated_at` 字段以便于审计与同步
    

### 3.6 数据库安全性设计

为了保证用户数据的安全性与隐私，系统数据库设置如下策略：

- 密码采用加盐Hash算法（如bcrypt）存储
    
- 数据库使用账号权限最小化原则，仅开放所需操作
    
- 对敏感信息如IP、设备信息等进行访问日志记录
    
- 定期备份数据库，防止数据丢失
    
- 使用SSL加密数据库连接，防止中间人攻击
    

### 3.7 数据库的作用与关系

在我们的即时通讯系统中，数据库是整个系统数据存储与管理的核心，承担了持久化数据存储、数据关系管理、快速查询支持和高并发访问支撑等关键功能。系统中所有的核心业务操作，包括用户注册与登录、消息发送与接收、好友管理、群聊互动等，均依赖数据库的高效支持与准确性保障。

#### （1）数据库的主要作用

1. **持久化存储用户数据与消息内容**
    
2. **支撑业务逻辑的执行与事务管理**
    
3. **提供高效的数据查询与索引检索**
    
4. **支撑横向扩展与高并发访问**
    
5. **保障数据的完整性与安全性**
    

#### （2）数据库中的数据对象关系图

- 用户（User）
    
- 好友关系（Friendship）
    
- 消息（Message）
    
- 群聊（GroupChat）
    
- 群成员（GroupMember）
    
- 登录记录（LoginLog）
    

### 3.8 数据库设计与 Java 后端开发的集成思路

本系统采用 Navicat 进行数据库建模与管理，通过 Spring Boot 框架中的 JPA 技术实现数据访问层的集成和操作。数据库表的结构与 Java 实体类一一对应，ORM（Object-Relational Mapping）技术可有效减少冗余代码，提升开发效率。

#### 3.8.1 系统选型理由

|技术组件|说明|
|---|---|
|Navicat|可视化数据库管理工具|
|MySQL|稳定、成熟、文档丰富|
|Spring Boot|快速构建 Web 应用框架|
|JPA (Hibernate)|Java 持久层标准接口|

#### 3.8.2 ORM 映射设计思路

- 数据库表 = Java 中的 `@Entity` 类
    
- 字段 = `@Column` 注解属性，主键用 `@Id`
    
- 外键关系 = `@OneToMany`, `@ManyToOne`, `@ManyToMany`
    
- 字段命名：数据库用下划线，Java 用驼峰
    
- 自动时间戳管理：`@CreationTimestamp`, `@UpdateTimestamp`
    

#### 3.8.3 实体类与表关系示意

|实体类名|表名|描述|
|---|---|---|
|`User`|`user`|用户信息|
|`Friendship`|`friendship`|好友关系|
|`Message`|`message`|消息内容|
|`GroupChat`|`group_chat`|群组信息|
|`GroupMember`|`group_member`|群聊成员|
|`LoginLog`|`login_log`|登录历史|

#### 3.8.4 数据访问层设计（DAO）

- 基础方法：`save()`, `findById()`, `findAll()` 等
    
- 派生查询：如 `findByUserIdAndStatus()`
    
- 注解查询：`@Query` + JPQL 或原生 SQL
    
- 动态构造查询：使用 `Specification` 接口
    

#### 3.8.5 数据库开发流程

1. 使用 Navicat 设计表结构
    
2. 导出建表 SQL 到 MySQL
    
3. 创建实体类添加注解
    
4. 开发 Repository 层接口
    
5. 单元测试（可用 H2）
    
6. 上线部署（Flyway 管理版本）
    

#### 3.8.6 常用库与依赖说明

|工具/依赖|用途|
|---|---|
|Spring Boot|应用启动配置|
|Spring Data JPA|持久层封装|
|MySQL Connector|JDBC 驱动|
|Hibernate|ORM 实现|
|Lombok|简化实体类|
|Flyway / Liquibase|数据库版本控制|
|Navicat|数据库管理|

### 3.9 开发规范

- 实体类命名：大驼峰命名
    
- 表字段命名：小写+下划线
    
- 字段映射：使用 `@Table(name=...)` 显式标识
    
- 时间字段：统一使用 `created_at`, `updated_at`
    
- 实体类与 DTO 解耦
    
- 建议使用 SQL View 辅助复杂查询

## 四、接口设计

#### 4.1.1 设计背景

为配合 PyQt5 临时通讯软件的界面功能实现，需设计一套完整的接口体系，实现客户端与服务器的数据交互，支撑用户认证、消息收发、联系人管理等核心功能。
#### 4.1.2 设计目标

*   提供稳定、高效的接口服务，保障客户端功能正常运行。

*   接口设计遵循 RESTful 规范，便于开发、维护和扩展。

*   确保接口的安全性和可靠性，防止数据泄露和非法访问。
#### 4.1.3 设计原则

*   **清晰性**：接口功能明确，命名规范，便于理解和使用。

*   **一致性**：接口设计风格统一，请求和响应格式一致。

*   **可扩展性**：接口设计考虑未来功能扩展，具备良好的可扩展性。

*   **安全性**：采用必要的安全措施，保障数据传输和接口访问的安全。

### （二）接口整体架构

#### 4.2.1 接口协议

*   **传输协议**：基于 HTTP/HTTPS 协议，确保数据传输的稳定性和安全性。

*   **数据格式**：请求和响应数据均采用 JSON 格式，便于解析和处理。
#### 4.2.2 接口版本控制
*   接口版本号包含在 URL 路径中，格式为`/api/v1/...`，便于版本升级和兼容。

#### 4.2.3 接口认证机制

*   **Token 认证**：用户登录成功后，服务器返回 Token，客户端在后续请求中携带 Token 进行认证。Token 有效期为 24 小时，过期后需重新登录。

*   **认证头**：请求头中添加`Authorization`字段，值为`Bearer {token}`。


### （三）认证接口设计

#### 4.3.1 登录接口

##### 4.3.1.1 接口描述
用户输入账号和密码进行登录，获取 Token。

##### 4.3.1.2 接口地址
`POST /api/v1/auth/login`

##### 4.3.1.3 请求参数

| 参数名&#xA;      | 类型&#xA;     | 是否必填&#xA; | 描述&#xA;  |
| ------------- | ----------- | --------- | -------- |
| username&#xA; | string&#xA; | 是&#xA;    | 用户名&#xA; |
| password&#xA; | string&#xA; | 是&#xA;    | 密码&#xA;  |

##### 4.3.1.4 请求示例
```
{

&#x20; "username": "user123",

&#x20; "password": "password123"
}
```

##### 4.3.1.5 响应参数

| 参数名&#xA;                      | 类型&#xA;     | 描述&#xA;           |
| ----------------------------- | ----------- | ----------------- |
| code&#xA;                     | int&#xA;    | 状态码，200 表示成功&#xA; |
| message&#xA;                  | string&#xA; | 状态描述&#xA;         |
| data&#xA;                     | object&#xA; | 数据对象&#xA;         |
| data.token&#xA;               | string&#xA; | 认证 Token&#xA;     |
| data.user\_info&#xA;          | object&#xA; | 用户信息&#xA;         |
| data.user\_info.id&#xA;       | int&#xA;    | 用户 ID&#xA;        |
| data.user\_info.username&#xA; | string&#xA; | 用户名&#xA;          |
| data.user\_info.nickname&#xA; | string&#xA; | 昵称&#xA;           |
| data.user\_info.avatar&#xA;   | string&#xA; | 头像 URL&#xA;       |

##### 4.3.1.6 响应示例
```
{

&#x20; "code": 200,

&#x20; "message": "登录成功",

&#x20; "data": {

&#x20;   "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",

&#x20;   "user\_info": {

&#x20;     "id": 1001,

&#x20;     "username": "user123",

&#x20;     "nickname": "张三",

&#x20;     "avatar": "https://example.com/avatar/1001.jpg"

&#x20;   }

&#x20; }

}
```

#### 4.3.2 注册接口

##### 4.3.2.1 接口描述

用户注册新账号。

##### 4.3.2.2 接口地址
`POST /api/v1/auth/register`

##### 4.3.2.3 请求参数

| 参数名&#xA;      | 类型&#xA;     | 是否必填&#xA; | 描述&#xA;            |
| ------------- | ----------- | --------- | ------------------ |
| username&#xA; | string&#xA; | 是&#xA;    | 用户名，长度 6-20 位&#xA; |
| password&#xA; | string&#xA; | 是&#xA;    | 密码，长度 8-20 位&#xA;  |
| nickname&#xA; | string&#xA; | 是&#xA;    | 昵称&#xA;            |
| phone&#xA;    | string&#xA; | 否&#xA;    | 手机号码&#xA;          |

##### 4.3.2.4 响应参数

| 参数名&#xA;     | 类型&#xA;     | 描述&#xA;                            |
| ------------ | ----------- | ---------------------------------- |
| code&#xA;    | int&#xA;    | 状态码，201 表示创建成功&#xA;                |
| message&#xA; | string&#xA; | 状态描述&#xA;                          |
| data&#xA;    | object&#xA; | 注册成功的用户信息，结构同登录接口的 user\_info&#xA; |

#### 4.3.3 退出登录接口

##### 4.3.3.1 接口描述
用户退出登录，使 Token 失效。

##### 4.3.3.2 接口地址
`POST /api/v1/auth/logout`

##### 4.3.3.3 请求参数
无，需携带 Token 认证。
##### 4.3.3.4 响应参数

| 参数名&#xA;     | 类型&#xA;     | 描述&#xA;           |
| ------------ | ----------- | ----------------- |
| code&#xA;    | int&#xA;    | 状态码，200 表示成功&#xA; |
| message&#xA; | string&#xA; | 状态描述&#xA;         |

### （四）消息接口设计

#### 4.4.1 获取消息列表接口

##### 4.4.1.1 接口描述
获取与指定联系人的消息列表，支持分页查询。

##### 4.4.1.2 接口地址
`GET /api/v1/messages/conversation/{contact_id}`

##### 4.4.1.3 请求参数

| 参数名&#xA;          | 类型&#xA;  | 是否必填&#xA; | 描述&#xA;                 |
| ----------------- | -------- | --------- | ----------------------- |
| contact\_id&#xA;  | int&#xA; | 是&#xA;    | 联系人 ID&#xA;             |
| page&#xA;         | int&#xA; | 否&#xA;    | 页码，默认 1&#xA;            |
| page\_size&#xA;   | int&#xA; | 否&#xA;    | 每页条数，默认 20&#xA;         |
| before\_time&#xA; | int&#xA; | 否&#xA;    | 获取该时间之前的消息，时间戳（毫秒）&#xA; |

##### 4.4.1.4 响应参数

| 参数名&#xA;                         | 类型&#xA;     | 描述&#xA;                               |
| -------------------------------- | ----------- | ------------------------------------- |
| code&#xA;                        | int&#xA;    | 状态码，200 表示成功&#xA;                     |
| message&#xA;                     | string&#xA; | 状态描述&#xA;                             |
| data&#xA;                        | object&#xA; | 消息列表数据&#xA;                           |
| data.messages&#xA;               | array&#xA;  | 消息数组&#xA;                             |
| data.messages.id&#xA;            | int&#xA;    | 消息 ID&#xA;                            |
| data.messages.sender\_id&#xA;    | int&#xA;    | 发送者 ID&#xA;                           |
| data.messages.receiver\_id&#xA;  | int&#xA;    | 接收者 ID&#xA;                           |
| data.messages.content&#xA;       | string&#xA; | 消息内容&#xA;                             |
| data.messages.message\_type&#xA; | int&#xA;    | 消息类型，1 - 文本，2 - 图片，3 - 文件，4 - 语音&#xA; |
| data.messages.create\_time&#xA;  | int&#xA;    | 发送时间，时间戳（毫秒）&#xA;                     |
| data.messages.is\_read&#xA;      | bool&#xA;   | 是否已读&#xA;                             |
| data.has\_more&#xA;              | bool&#xA;   | 是否有更多消息&#xA;                          |

#### 4.4.2 发送消息接口

##### 4.4.2.1 接口描述
发送消息给指定联系人。
##### 4.4.2.2 接口地址
`POST /api/v1/messages/send`

##### 4.4.2.3 请求参数

| 参数名&#xA;           | 类型&#xA;     | 是否必填&#xA; | 描述&#xA;                                   |
| ------------------ | ----------- | --------- | ----------------------------------------- |
| receiver\_id&#xA;  | int&#xA;    | 是&#xA;    | 接收者 ID&#xA;                               |
| content&#xA;       | string&#xA; | 是&#xA;    | 消息内容&#xA;                                 |
| message\_type&#xA; | int&#xA;    | 是&#xA;    | 消息类型，1 - 文本，2 - 图片，3 - 文件，4 - 语音&#xA;     |
| file\_path&#xA;    | string&#xA; | 否&#xA;    | 文件路径，当 message\_type 为 2、3、4 时必填&#xA;     |
| file\_name&#xA;    | string&#xA; | 否&#xA;    | 文件名，当 message\_type 为 2、3、4 时必填&#xA;      |
| file\_size&#xA;    | int&#xA;    | 否&#xA;    | 文件大小（字节），当 message\_type 为 2、3、4 时必填&#xA; |

##### 4.4.2.4 响应参数

| 参数名&#xA;     | 类型&#xA;     | 描述&#xA;                                 |
| ------------ | ----------- | --------------------------------------- |
| code&#xA;    | int&#xA;    | 状态码，200 表示成功&#xA;                       |
| message&#xA; | string&#xA; | 状态描述&#xA;                               |
| data&#xA;    | object&#xA; | 发送成功的消息数据，结构同获取消息列表接口的 messages 字段&#xA; |

#### 4.4.3 标记消息已读接口

##### 4.4.3.1 接口描述
将与指定联系人的消息标记为已读。

##### 4.4.3.2 接口地址
`POST /api/v1/messages/mark-read`

##### 4.4.3.3 请求参数

| 参数名&#xA;         | 类型&#xA;  | 是否必填&#xA; | 描述&#xA;     |
| ---------------- | -------- | --------- | ----------- |
| contact\_id&#xA; | int&#xA; | 是&#xA;    | 联系人 ID&#xA; |

##### 4.4.3.4 响应参数

| 参数名&#xA;     | 类型&#xA;     | 描述&#xA;           |
| ------------ | ----------- | ----------------- |
| code&#xA;    | int&#xA;    | 状态码，200 表示成功&#xA; |
| message&#xA; | string&#xA; | 状态描述&#xA;         |

### （五）联系人接口设计

#### 4.5.1 获取联系人列表接口

##### 4.5.1.1 接口描述
获取用户的联系人列表，支持分组查询。

##### 4.5.1.2 接口地址
`GET /api/v1/contacts`

##### 4.5.1.3 请求参数

| 参数名&#xA;         | 类型&#xA;     | 是否必填&#xA; | 描述&#xA;              |
| ---------------- | ----------- | --------- | -------------------- |
| group\_id&#xA;   | int&#xA;    | 否&#xA;    | 分组 ID，默认获取所有分组&#xA;  |
| search\_key&#xA; | string&#xA; | 否&#xA;    | 搜索关键词，按昵称或用户名搜索&#xA; |

##### 4.5.1.4 响应参数

| 参数名&#xA;                                      | 类型&#xA;     | 描述&#xA;                        |
| --------------------------------------------- | ----------- | ------------------------------ |
| code&#xA;                                     | int&#xA;    | 状态码，200 表示成功&#xA;              |
| message&#xA;                                  | string&#xA; | 状态描述&#xA;                      |
| data&#xA;                                     | object&#xA; | 联系人列表数据&#xA;                   |
| data.groups&#xA;                              | array&#xA;  | 分组数组&#xA;                      |
| data.groups.id&#xA;                           | int&#xA;    | 分组 ID&#xA;                     |
| data.groups.name&#xA;                         | string&#xA; | 分组名称&#xA;                      |
| data.groups.contacts&#xA;                     | array&#xA;  | 分组内的联系人数组&#xA;                 |
| data.groups.contacts.id&#xA;                  | int&#xA;    | 联系人 ID&#xA;                    |
| data.groups.contacts.username&#xA;            | string&#xA; | 用户名&#xA;                       |
| data.groups.contacts.nickname&#xA;            | string&#xA; | 昵称&#xA;                        |
| data.groups.contacts.avatar&#xA;              | string&#xA; | 头像 URL&#xA;                    |
| data.groups.contacts.online\_status&#xA;      | int&#xA;    | 在线状态，1 - 在线，2 - 离线，3 - 离开&#xA; |
| data.groups.contacts.last\_message&#xA;       | string&#xA; | 最新消息内容&#xA;                    |
| data.groups.contacts.last\_message\_time&#xA; | int&#xA;    | 最新消息时间，时间戳（毫秒）&#xA;            |
| data.groups.contacts.unread\_count&#xA;       | int&#xA;    | 未读消息数量&#xA;                    |

#### 4.5.2 添加联系人接口

##### 4.5.2.1 接口描述
添加新的联系人。

##### 4.5.2.2 接口地址
`POST /api/v1/contacts/add`

##### 4.5.2.3 请求参数

| 参数名&#xA;               | 类型&#xA;     | 是否必填&#xA; | 描述&#xA;                    |
| ---------------------- | ----------- | --------- | -------------------------- |
| contact\_username&#xA; | string&#xA; | 是&#xA;    | 联系人用户名&#xA;                |
| group\_id&#xA;         | int&#xA;    | 否&#xA;    | 分组 ID，默认添加到 “我的好友” 分组&#xA; |
| remark&#xA;            | string&#xA; | 否&#xA;    | 备注信息&#xA;                  |

##### 4.5.2.4 响应参数

| 参数名&#xA;     | 类型&#xA;     | 描述&#xA;                                     |
| ------------ | ----------- | ------------------------------------------- |
| code&#xA;    | int&#xA;    | 状态码，200 表示成功，400 表示用户不存在，409 表示已添加为联系人&#xA; |
| message&#xA; | string&#xA; | 状态描述&#xA;                                   |

#### 4.5.3 删除联系人接口

##### 4.5.3.1 接口描述
删除指定的联系人。

##### 4.5.3.2 接口地址
`DELETE /api/v1/contacts/{contact_id}`

##### 4.5.3.3 请求参数

| 参数名&#xA;         | 类型&#xA;  | 是否必填&#xA; | 描述&#xA;     |
| ---------------- | -------- | --------- | ----------- |
| contact\_id&#xA; | int&#xA; | 是&#xA;    | 联系人 ID&#xA; |

##### 4.5.3.4 响应参数

| 参数名&#xA;     | 类型&#xA;     | 描述&#xA;           |
| ------------ | ----------- | ----------------- |
| code&#xA;    | int&#xA;    | 状态码，200 表示成功&#xA; |
| message&#xA; | string&#xA; | 状态描述&#xA;         |

### （六）接口错误处理

#### 4.6.1 状态码定义
*   **200 OK**：请求成功。

*   **201 Created**：资源创建成功，如注册接口。

*   **400 Bad Request**：请求参数错误。

*   **401 Unauthorized**：未授权，Token 无效或过期。

*   **403 Forbidden**：禁止访问，权限不足。

*   **404 Not Found**：请求的资源不存在。

*   **409 Conflict**：资源已存在，如添加已存在的联系人。

*   **500 Internal Server Error**：服务器内部错误。
#### 4.6.2 错误响应格式
```
{

&#x20; "code": 400,

&#x20; "message": "请求参数错误",

&#x20; "error\_details": "username参数不能为空"

}
```

## 五、界面设计​

### （一）设计引言
#### 5.1 设计背景​

在当今信息快速传递的时代，临时通讯需求日益增多，如临时团队协作、应急沟通等场景。基于 PyQt5 开发一款临时通讯软件，可满足用户在特定时间段内便捷、高效沟通的需求。​
#### 5.1.2 设计目标​

本软件界面设计旨在为用户提供简洁、直观、易用的操作体验，实现快速登录、联系人管理、消息收发等核心功能，同时保证界面的美观性和响应式设计，适配不同屏幕尺寸。​
#### 5.1.3 设计原则​

- 简洁性：界面布局简洁明了，避免过多复杂元素，让用户能快速找到所需功能。​
- 易用性：操作流程简单易懂，符合用户日常使用习惯，降低学习成本。​
- 美观性：采用现代简约的设计风格，合理搭配色彩和字体，提升界面视觉效果。​
- 响应性：界面元素能根据屏幕尺寸自动调整，确保在不同设备上都有良好的显示效果。​
### （二）整体架构设计​

#### 5.2.1 界面整体布局​

软件采用主窗口加子窗口的架构模式，主窗口为用户提供导航和主要功能入口，子窗口用于展示具体功能内容。整体布局采用侧边栏加主内容区的形式，侧边栏放置功能导航和联系人列表，主内容区显示当前功能的具体内容。​

### 5.2.2 色彩方案​

- 主色调：选择粉色系（#FFE4FF）作为主色调，粉色给人以轻松的感觉，符合通讯软件的属性。​

- 辅助色：使用灰色系（#F5F7FA、#E5E6EB、#C9CDD4、#86909C）作为辅助色，用于背景、边框和分隔线等，使界面层次分明。​

- 强调色：采用绿色（#00B42A）作为消息已读状态的提示色，红色（#F53F3F）作为错误提示和重要警告的颜色，黄色（#FF7D00）作为消息未读状态的提示色。​

#### 5.2.3 字体方案​

- 标题字体：使用思源黑体 CN Medium，字号 16-20px，用于界面标题和功能模块标题。​
- 正文字体：采用思源黑体 CN Regular，字号 14px，用于消息内容、联系人名称等正文内容。​
- 辅助文字：使用思源黑体 CN Light，字号 12px，用于提示信息、时间戳等辅助文字。​

### （三）登录界面设计​

#### 5.3.1 界面布局​

登录界面采用居中布局，背景为浅灰色（#F5F7FA），中间放置登录卡片。卡片尺寸为 400px×300px，边框半径 8px，背景为白色（#FFFFFF）。​

#### 5.3.2 界面元素​

- 软件 Logo：位于卡片左侧，尺寸 80px×80px，采用白色主色调设计。

- 标题文字：“临时通讯软件”，字体为思源黑体 CN Medium，字号 20px，颜色 # 333333，位于 Logo 下方。​

- 账号输入框：位于卡片中部偏上位置，宽度 320px，高度 40px，边框半径 4px，边框颜色 # E5E6EB，提示文字 “请输入账号”，字体为思源黑体 CN Regular，字号 14px，颜色 # 86909C。​

- 密码输入框：位于账号输入框下方，样式相同，提示文字 “请输入密码”，增加 “显示密码” 复选框，位于输入框右侧，字体 12px。​
- 登录按钮：位于密码输入框下方，宽度 320px，高度 44px，背景颜色 # 165DFF，边框半径 4px，字体为思源黑体 CN Medium，字号 14px，颜色白色，点击后按钮颜色变为 # 0D47A1。
​
- 注册按钮：位于登录按钮右侧，字体为思源黑体 CN Regular，字号 14px，颜色 # 165DFF，点击后跳转到注册界面。​

- 忘记密码：位于卡片底部，字体为思源黑体 CN Light，字号 12px，颜色 # 86909C，点击后跳转到找回密码界面。​

#### 5.3.3 交互流程​

1. 用户打开软件，进入登录界面。​
2. 输入账号和密码，可选择显示密码。​
3. 点击登录按钮，系统验证账号密码。​
4. 验证通过，进入主界面；验证失败，显示错误提示。​
5. 点击注册按钮，进入注册界面；点击忘记密码，进入找回密码界面。​

### （四）主界面设计​

#### 5.4.1 界面布局​
主界面采用左侧边栏加右侧主内容区的布局方式。左侧边栏宽度 240px，右侧主内容区占据剩余空间。顶部为状态栏，显示用户信息、通知图标等。​

#### 5.4.2 左侧边栏设计​

- 用户信息栏：位于边栏顶部，高度 80px，背景颜色 # 165DFF，显示用户头像、昵称和在线状态。头像尺寸 48px×48px，边框半径 50%，昵称字体为思源黑体 CN Medium，字号 14px，颜色白色，在线状态为绿色圆点加 “在线” 文字。​
- 
- 功能导航区：位于用户信息栏下方，包含 “消息”“联系人”“群组”“设置” 等功能图标和文字。图标尺寸 24px×24px，文字字体为思源黑体 CN Regular，字号 14px，颜色 # 333333。当前选中功能图标和文字颜色为 # 165DFF，背景颜色 # F5F7FA。​

- 联系人列表区：位于功能导航区下方，占据边栏剩余空间。列表项包含联系人头像、昵称、最新消息预览和时间戳。头像尺寸 40px×40px，昵称字体 14px，最新消息预览字体 12px，时间戳字体 12px，颜色 # 86909C。未读消息显示红色圆点和未读数量。​

#### 5.4.3 右侧主内容区设计​

##### 5.4.3.1 消息界面​

- 聊天信息栏：位于主内容区顶部，高度 60px，背景颜色 # FFFFFF，显示当前聊天对象的头像、昵称和返回按钮。头像尺寸 40px×40px，昵称字体 14px，返回按钮图标 24px×24px。​

- 消息显示区：占据主内容区大部分空间，背景颜色 # F5F7FA，显示聊天消息。自己发送的消息位于右侧，背景颜色 # 165DFF，文字颜色白色，气泡边框半径 8px；接收的消息位于左侧，背景颜色 # FFFFFF，文字颜色 # 333333，气泡边框半径 8px。消息包含时间戳，字体 12px，颜色 # 86909C。​

- 消息输入区：位于主内容区底部，高度 80px，包含文本输入框、表情按钮、文件发送按钮和发送按钮。文本输入框宽度占据大部分空间，高度 40px，边框半径 4px，边框颜色 # E5E6EB，提示文字 “输入消息...”，字体 12px，颜色 # 86909C。表情按钮和文件发送按钮尺寸 24px×24px，发送按钮宽度 80px，高度 40px，背景颜色 # 165DFF，字体 14px，颜色白色。​

##### 5.4.3.2 联系人界面​

- 搜索栏：位于主内容区顶部，高度 40px，宽度 300px，边框半径 4px，边框颜色 # E5E6EB，提示文字 “搜索联系人...”，字体 12px，颜色 # 86909C，右侧包含搜索按钮，图标 24px×24px。​

- 联系人分组区：位于搜索栏下方，包含 “最近联系”“好友”“同事” 等分组标签，标签字体 14px，颜色 # 333333，当前选中标签颜色 # 165DFF，底部有下划线。​

- 联系人列表区：位于分组区下方，显示对应分组的联系人，布局和样式与主界面边栏的联系人列表相同。​

##### 5.4.3.3 群组界面​

- 群组列表区：布局和样式与联系人列表类似，显示群组头像、名称、最新消息预览和时间戳。​

- 创建群组按钮：位于主内容区右上角，宽度 120px，高度 36px，背景颜色 # 165DFF，字体 14px，颜色白色，点击后弹出创建群组窗口。​

##### 5.4.3.4 设置界面​

- 设置分类区：左侧边栏显示设置分类，包含 “账号设置”“隐私设置”“消息设置”“界面设置” 等，右侧主内容区显示对应分类的设置项。​

- 设置项区：设置项采用表单形式，包含开关按钮、下拉菜单、输入框等控件，标签字体 14px，控件字体 14px。​

#### 5.4.4 顶部状态栏设计​

- 用户头像：位于状态栏左侧，尺寸 32px×32px，边框半径 50%。​

- 通知图标：位于状态栏右侧，包含消息通知、系统通知等图标，尺寸 24px×24px，未读通知显示红色圆点。​

- 退出登录按钮：位于通知图标右侧，字体 14px，颜色 # 165DFF，点击后弹出确认退出对话框。​

### （五）消息交互界面设计​

#### 5.5.1 消息发送与接收​

- 发送消息：用户在消息输入框中输入内容，点击发送按钮或按回车键，消息显示在右侧气泡中，同时发送给对方。发送过程中显示加载动画，发送成功后显示发送时间。​

- 接收消息：当收到新消息时，状态栏通知图标闪烁，联系人列表中对应联系人显示未读消息数量，主内容区消息显示区自动滚动到最新消息，新消息显示在左侧气泡中，并有动画效果提示。​

#### 5.5.2 消息类型​

- 文本消息：支持普通文本、表情符号输入，表情符号点击表情按钮弹出表情选择面板，面板包含常用表情分类，点击表情插入到输入框中。​

- 文件消息：点击文件发送按钮，弹出文件选择对话框，支持选择图片、文档等文件，发送后显示文件图标、名称和大小，点击可下载或查看。​

- 语音消息：长按语音按钮开始录制，松开结束录制，发送后显示语音图标和时长，点击可播放语音。​
#### 5.5.3 消息操作​

- 消息回复：长按消息，弹出操作菜单，包含 “回复”“转发”“复制”“删除” 等选项。点击 “回复”，输入框自动引用该消息，方便用户回复。​

- 消息转发：选择 “转发”，可将消息转发给其他联系人或群组。​

- 消息复制：选择 “复制”，可将消息内容复制到剪贴板。​

- 消息删除：选择 “删除”，可删除自己发送的消息或删除聊天记录中的消息。​

#### 5.5.4 未读消息提醒​

- 当用户切换到其他聊天窗口或界面时，收到新消息时，状态栏通知图标闪烁，对应联系人列表项显示未读消息数量和黄色圆点。​

- 点击通知图标或联系人列表项，自动跳转到对应的聊天窗口，并标记消息为已读。​

### （六）响应式设计​

#### 5.6.1 屏幕尺寸适配​

- 桌面端：屏幕宽度大于 1024px 时，采用左侧边栏加右侧主内容区的布局，边栏宽度 240px，主内容区占据剩余空间。​

- 平板端：屏幕宽度在 768-1024px 之间时，左侧边栏可折叠，点击展开 / 收起按钮切换边栏显示状态，展开时宽度 200px，收起时只显示图标。​

- 手机端：屏幕宽度小于 768px 时，采用底部导航栏的布局方式，导航栏包含 “消息”“联系人”“群组”“设置” 等图标和文字，点击切换功能模块，联系人列表和消息界面采用全屏显示。​

#### 5.6.2 界面元素适配​

- 字体大小：根据屏幕尺寸自动调整字体大小，使用相对单位（如 px、em），确保在不同设备上文字清晰可读。​

- 控件尺寸：按钮、输入框等控件的尺寸根据屏幕尺寸适当调整，保持合适的点击区域，避免在手机端难以点击。​

- 布局调整：在小屏幕设备上，调整界面元素的排列方式，如将横向排列改为纵向排列，确保界面布局合理。​
### （七）总结​

本界面设计文档详细阐述了基于 PyQt5 的临时通讯软件的界面设计方案，包括整体架构、色彩方案、字体方案、各功能界面的布局和元素设计，以及交互流程和响应式设计等内容。通过遵循简洁、易用、美观、响应的设计原则，旨在为用户提供良好的操作体验，满足临时通讯的需求。在实际开发过程中，可根据具体需求和用户反馈对设计进行进一步优化和调整。
